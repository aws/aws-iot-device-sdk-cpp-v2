<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AWS IoT Device SDK C++ v2: Constant Time Verification Tests for s2n</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AWS IoT Device SDK C++ v2<span id="projectnumber">&#160;1.14.0</span>
   </div>
   <div id="projectbrief">AWS IoT Device SDK C++ v2</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Constant Time Verification Tests for s2n </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This repository contains tests which ensure that key s2n functions are not susceptible to timing attacks and are indeed constant time.</p>
<p >For more details, see <a href="https://github.com/awslabs/s2n/issues/463">https://github.com/awslabs/s2n/issues/463</a></p>
<h1><a class="anchor" id="autotoc_md530"></a>
What are timing side channels</h1>
<p >Crypographic protocols such as TLS are supposed to keep secret information secret. They do this by ensuring that WHICH bytes go over the wire is hidden using encryption. However, if the code is not carefully written, WHEN bytes go over the wire may depend on values that were supposed to remain secret.</p>
<p >For example, if code checks a password as follows</p>
<div class="fragment"><div class="line">for (i = 0; i &lt; length; ++i) {</div>
<div class="line">  if password[i] != input[i] {</div>
<div class="line">    send(&quot;bad password&quot;);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p> then the amount of time until the reply message is received will depend on which byte in the password is incorrect. An attacker can simply guess</p><ul>
<li>a*******</li>
<li>b*******</li>
<li>c*******</li>
</ul>
<p >until the time to receive the error message changes, and then they know the first letter in the password. Repeating for the remaining characters turns an exponential guessing challenge into a linear one.</p>
<p >There are two major ways that timing side channels appear in code</p>
<h2><a class="anchor" id="autotoc_md531"></a>
Branches that depend on secret data</h2>
<p >In this case, the program may execute more code, and hence take more time, in one branch than another. The password example above is a branch based timing side-channel.</p>
<h2><a class="anchor" id="autotoc_md532"></a>
Memory accesses that depend on secret data</h2>
<p >In this case, if one memory location is in cache, while another is not, there will be a detectable delay fetching the location from main memory. For example, an AES computation that uses software lookup tables can leak the secret key over the network based on cache timing <a href="https://cr.yp.to/antiforgery/cachetiming-20050414.pdf">https://cr.yp.to/antiforgery/cachetiming-20050414.pdf</a></p>
<h2><a class="anchor" id="autotoc_md533"></a>
The implication</h2>
<p >The runtime of code should not depend on the value of secret data, and therefore, cryptographic code should ensure that</p><ol type="1">
<li>No branch depends on secret data</li>
<li>No memory access depends on secret data</li>
</ol>
<h1><a class="anchor" id="autotoc_md534"></a>
The tests</h1>
<p >Currently, we have constant-time proofs of two functions from utils/s2n_safety.c</p><ol type="1">
<li>s2n_constant_time_equals</li>
<li>s2n_constant_time_copy_or_dont</li>
</ol>
<p >A proof proceeds in the following steps:</p><ol type="1">
<li>Annotate public inputs using <a class="el" href="ctverif_2s2n__annotations_8h.html#a82b5a2764625cc3f652354d7ded65476">S2N_PUBLIC_INPUT()</a>. All other inputs are assumed to be private</li>
<li>Use the ct-verif tool, which compiles the program into the Boogie intermediate representation, and adds assertions that:<ol type="a">
<li>No branch depends on secret data</li>
<li>No memory access depends on secret data</li>
</ol>
</li>
<li>Use the Boogie program-analysis framework to convert the code under test into an SMT formula</li>
<li>Use the z3 prover to prove that either:<ul>
<li>None of the assertions can be violated (in which case the code is constant time) OR</li>
<li>Some of the assertions can be violated, in which case the code is not guaranteed to be constant time.</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md535"></a>
How to execute the tests</h1>
<h2><a class="anchor" id="autotoc_md536"></a>
Install the dependencies</h2>
<p >Running these tests will require the following dependencies (tested on Ubuntu 14.04). To see how to install this on a clean ubuntu machine, take a look at the .travis scripts in this repo.</p>
<ul>
<li>ct-verif (available from <a href="https://github.com/imdea-software/verifying-constant-time/">https://github.com/imdea-software/verifying-constant-time/</a>)<ul>
<li>Export its base directory as $CTVERIF_DIR</li>
</ul>
</li>
<li>SMACK and all its dependencies<ul>
<li>The easiest way to get these is to use the build.sh in smack/bin</li>
<li>Ensure that all of the installed depencies are on the $PATH</li>
<li>source the smack.environment that the smack build script creates</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md537"></a>
Move the code you want to test into place</h2>
<div class="fragment"><div class="line">cp ../../utils/s2n_safety.c .</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md538"></a>
Execute the test</h2>
<div class="fragment"><div class="line">make clean</div>
<div class="line">EXPECTED_PASS=2</div>
<div class="line">EXPECTED_FAIL=0</div>
<div class="line">make 2&gt;&amp;1 | ./count_success.pl $EXPECTED_PASS $EXPECTED_FAIL</div>
</div><!-- fragment --><p >If both tests pass, you will see </p><div class="fragment"><div class="line">verified: 2 errors: 0 as expected</div>
</div><!-- fragment --><p >If not all tests pass, you will see a message like:</p>
<div class="fragment"><div class="line">ERROR:  Expected verified: 2    errors: 0.</div>
<div class="line">        Got      verified: 1    errors: 1.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md539"></a>
Questions?</h1>
<p >contact <a href="#" onclick="location.href='mai'+'lto:'+'dsn'+'@a'+'maz'+'on'+'.co'+'m'; return false;">dsn@a<span style="display: none;">.nosp@m.</span>mazo<span style="display: none;">.nosp@m.</span>n.com</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
