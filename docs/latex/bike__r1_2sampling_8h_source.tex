\hypertarget{bike__r1_2sampling_8h_source}{}\doxysection{sampling.\+h}
\label{bike__r1_2sampling_8h_source}\index{crt/aws-\/crt-\/cpp/crt/s2n/pq-\/crypto/bike\_r1/sampling.h@{crt/aws-\/crt-\/cpp/crt/s2n/pq-\/crypto/bike\_r1/sampling.h}}
\mbox{\hyperlink{bike__r1_2sampling_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/* Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.}}
\DoxyCodeLine{2 \textcolor{comment}{ * SPDX-\/License-\/Identifier: Apache-\/2.0"{}}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ * Written by Nir Drucker and Shay Gueron}}
\DoxyCodeLine{5 \textcolor{comment}{ * AWS Cryptographic Algorithms Group.}}
\DoxyCodeLine{6 \textcolor{comment}{ * (ndrucker@amazon.com, gueron@amazon.com)}}
\DoxyCodeLine{7 \textcolor{comment}{ */}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{bike__r2_2aes__ctr__prf_8h}{aes\_ctr\_prf.h}}"{}}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{s2n__pq__random_8h}{pq-\/crypto/s2n\_pq\_random.h}}"{}}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include "{}utils/s2n\_result.h"{}}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{bike__r2_2utilities_8h}{utilities.h}}"{}}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{keyword}{typedef} \textcolor{keyword}{enum}}
\DoxyCodeLine{17 \{}
\DoxyCodeLine{18   \mbox{\hyperlink{bike__r1_2sampling_8h_a05a502058ce3ce1b6acbdcfec4cdcd7ea336c1d44f98ed8d9192d3592f183258c}{NO\_RESTRICTION}} = 0,}
\DoxyCodeLine{19   \mbox{\hyperlink{bike__r1_2sampling_8h_a05a502058ce3ce1b6acbdcfec4cdcd7ea21923a757deb45b5398e7dbbaf571100}{MUST\_BE\_ODD}}    = 1}
\DoxyCodeLine{20 \} \mbox{\hyperlink{bike__r1_2sampling_8h_a05a502058ce3ce1b6acbdcfec4cdcd7e}{must\_be\_odd\_t}};}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \mbox{\hyperlink{bike__r1_2defs_8h_ad320c6003c1b51d78cb343e674b9432f}{\_INLINE\_}} \mbox{\hyperlink{s2n_2pq-crypto_2bike__r1_2error_8h_ae78f298365f3659d41525fa9b2b855e2}{ret\_t}}}
\DoxyCodeLine{23 \mbox{\hyperlink{bike__r1_2sampling_8h_a20f5002cf1df5bd2a231d26d04bd3634}{get\_seeds}}(\mbox{\hyperlink{bike__r1__kem_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}} \mbox{\hyperlink{structseeds__s}{seeds\_t}} *seeds)}
\DoxyCodeLine{24 \{}
\DoxyCodeLine{25   \textcolor{keywordflow}{if}(s2n\_result\_is\_ok(\mbox{\hyperlink{s2n__pq__random_8c_aca9ff0949b1e6fdd222e453816da5ecd}{s2n\_get\_random\_bytes}}(seeds-\/>seed[0].raw, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structseeds__s}{seeds\_t}}))))}
\DoxyCodeLine{26   \{}
\DoxyCodeLine{27     \textcolor{keywordflow}{return} \mbox{\hyperlink{aws__test__harness_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS}};}
\DoxyCodeLine{28   \}}
\DoxyCodeLine{29   \textcolor{keywordflow}{else}}
\DoxyCodeLine{30   \{}
\DoxyCodeLine{31     \mbox{\hyperlink{s2n_2pq-crypto_2bike__r1_2error_8h_afd0143325cf546e89c70dca08cae0cd6}{BIKE\_ERROR}}(\mbox{\hyperlink{s2n_2pq-crypto_2bike__r1_2error_8h_a16e0968bf2b44ba99b9a308421014f4da52b298adf78a0fc3f39e15649a88cafc}{E\_FAIL\_TO\_GET\_SEED}});}
\DoxyCodeLine{32   \}}
\DoxyCodeLine{33 \}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{comment}{// Return's an array of r pseudorandom bits}}
\DoxyCodeLine{36 \textcolor{comment}{// No restrictions exist for the top or bottom bits -\/}}
\DoxyCodeLine{37 \textcolor{comment}{// in case an odd number is required then set must\_be\_odd=1}}
\DoxyCodeLine{38 \textcolor{comment}{// Uses the provided prf context}}
\DoxyCodeLine{39 \mbox{\hyperlink{s2n_2pq-crypto_2bike__r1_2error_8h_ae78f298365f3659d41525fa9b2b855e2}{ret\_t}}}
\DoxyCodeLine{40 \mbox{\hyperlink{bike__r1_2sampling_8h_aa09797bc4d92fa82e01375320f5a6169}{sample\_uniform\_r\_bits\_with\_fixed\_prf\_context}}(\mbox{\hyperlink{bike__r1__kem_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}} \mbox{\hyperlink{structr__s}{r\_t}} *r,}
\DoxyCodeLine{41                                              \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} \mbox{\hyperlink{bike__r1__kem_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}}}
\DoxyCodeLine{42                                                  \mbox{\hyperlink{structaes__ctr__prf__state__s}{aes\_ctr\_prf\_state\_t}} *prf\_state,}
\DoxyCodeLine{43                                              \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} \mbox{\hyperlink{bike__r1_2sampling_8h_a05a502058ce3ce1b6acbdcfec4cdcd7e}{must\_be\_odd\_t}} must\_be\_odd);}
\DoxyCodeLine{44 }
\DoxyCodeLine{45 \textcolor{comment}{// Return's an array of r pseudorandom bits}}
\DoxyCodeLine{46 \textcolor{comment}{// No restrictions exist for the top or bottom bits -\/}}
\DoxyCodeLine{47 \textcolor{comment}{// in case an odd number is  required then set must\_be\_odd=1}}
\DoxyCodeLine{48 \mbox{\hyperlink{bike__r1_2defs_8h_ad320c6003c1b51d78cb343e674b9432f}{\_INLINE\_}} \mbox{\hyperlink{s2n_2pq-crypto_2bike__r1_2error_8h_ae78f298365f3659d41525fa9b2b855e2}{ret\_t}}}
\DoxyCodeLine{49 \mbox{\hyperlink{bike__r1_2sampling_8h_aed24db3730bb3edf003099376a57f374}{sample\_uniform\_r\_bits}}(\mbox{\hyperlink{bike__r1__kem_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}} \mbox{\hyperlink{structr__s}{r\_t}} *r,}
\DoxyCodeLine{50                       \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} \textcolor{keyword}{const} \mbox{\hyperlink{structseed__s}{seed\_t}} *      seed,}
\DoxyCodeLine{51                       \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} \textcolor{keyword}{const} \mbox{\hyperlink{bike__r1_2sampling_8h_a05a502058ce3ce1b6acbdcfec4cdcd7e}{must\_be\_odd\_t}} must\_be\_odd)}
\DoxyCodeLine{52 \{}
\DoxyCodeLine{53   \textcolor{comment}{// For the seedexpander}}
\DoxyCodeLine{54   DEFER\_CLEANUP(\mbox{\hyperlink{structaes__ctr__prf__state__s}{aes\_ctr\_prf\_state\_t}} prf\_state = \{0\}, \mbox{\hyperlink{bike__r1_2aes__ctr__prf_8h_adbb0d46d55b357fa3cc00021ee60d848}{aes\_ctr\_prf\_state\_cleanup}});}
\DoxyCodeLine{55 }
\DoxyCodeLine{56   GUARD(\mbox{\hyperlink{bike__r1_2functions__renaming_8h_a57b6c09694e52d1dca92446abecc99c4}{init\_aes\_ctr\_prf\_state}}(\&prf\_state, \mbox{\hyperlink{bike__r1_2aes_8h_a43c2fa15b9afdbb8c242ab533a2142c4}{MAX\_AES\_INVOKATION}}, seed));}
\DoxyCodeLine{57 }
\DoxyCodeLine{58   GUARD(\mbox{\hyperlink{bike__r1_2sampling_8h_aa09797bc4d92fa82e01375320f5a6169}{sample\_uniform\_r\_bits\_with\_fixed\_prf\_context}}(r, \&prf\_state, must\_be\_odd));}
\DoxyCodeLine{59 }
\DoxyCodeLine{60   \textcolor{keywordflow}{return} \mbox{\hyperlink{aws__test__harness_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS}};}
\DoxyCodeLine{61 \}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63 \textcolor{comment}{// Generate a pseudorandom r of length len with a set weight}}
\DoxyCodeLine{64 \textcolor{comment}{// Using the pseudorandom ctx supplied}}
\DoxyCodeLine{65 \textcolor{comment}{// Outputs also a compressed (not ordered) list of indices}}
\DoxyCodeLine{66 \mbox{\hyperlink{s2n_2pq-crypto_2bike__r1_2error_8h_ae78f298365f3659d41525fa9b2b855e2}{ret\_t}}}
\DoxyCodeLine{67 \mbox{\hyperlink{bike__r1_2sampling_8h_ad0310a8eeac09c4666dfdceaa345f969}{generate\_sparse\_rep}}(\mbox{\hyperlink{bike__r1__kem_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}} uint64\_t *\mbox{\hyperlink{namespace_aws_a63d22a0af7bbcae8152004baa4756a4d}{a}},}
\DoxyCodeLine{68                     \mbox{\hyperlink{bike__r1__kem_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}} \mbox{\hyperlink{crt_2s2n_2pq-crypto_2bike__r1_2_types_8h_a06bc59d72376a01057e18da78887bdc1}{idx\_t}}     wlist[],}
\DoxyCodeLine{69                     \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} uint32\_t   weight,}
\DoxyCodeLine{70                     \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} uint32\_t   \mbox{\hyperlink{aws-c-iot_2include_2aws_2iotdevice_2external_2c_j_s_o_n_8h_a0f1e4ab31fd4f3ca4329091911f1f1af}{len}},}
\DoxyCodeLine{71                     \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} uint32\_t   padded\_len,}
\DoxyCodeLine{72                     \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} \mbox{\hyperlink{bike__r1__kem_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}} \mbox{\hyperlink{structaes__ctr__prf__state__s}{aes\_ctr\_prf\_state\_t}} *prf\_state);}
\DoxyCodeLine{73 }
\DoxyCodeLine{74 \mbox{\hyperlink{bike__r1_2defs_8h_a95e1d92b2619a326b2e86600f3d23100}{EXTERNC}} \textcolor{keywordtype}{void}}
\DoxyCodeLine{75 \mbox{\hyperlink{bike__r1_2sampling_8h_a57ca0302d333cbeb99b98fcb518db459}{secure\_set\_bits}}(\mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} \mbox{\hyperlink{bike__r1__kem_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}} uint64\_t *\mbox{\hyperlink{namespace_aws_a63d22a0af7bbcae8152004baa4756a4d}{a}},}
\DoxyCodeLine{76                 \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} \textcolor{keyword}{const} \mbox{\hyperlink{crt_2s2n_2pq-crypto_2bike__r1_2_types_8h_a06bc59d72376a01057e18da78887bdc1}{idx\_t}}   wlist[],}
\DoxyCodeLine{77                 \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} uint32\_t      a\_len,}
\DoxyCodeLine{78                 \mbox{\hyperlink{bike__r1__kem_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}} uint32\_t      weight);}

\end{DoxyCode}
