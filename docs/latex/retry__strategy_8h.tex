\hypertarget{retry__strategy_8h}{}\doxysection{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/io/include/aws/io/retry\+\_\+strategy.h File Reference}
\label{retry__strategy_8h}\index{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/io/include/aws/io/retry\_strategy.h@{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/io/include/aws/io/retry\_strategy.h}}
{\ttfamily \#include $<$aws/io/exports.\+h$>$}\newline
{\ttfamily \#include $<$aws/common/atomics.\+h$>$}\newline
{\ttfamily \#include $<$aws/common/byte\+\_\+buf.\+h$>$}\newline
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structaws__retry__strategy__vtable}{aws\+\_\+retry\+\_\+strategy\+\_\+vtable}}
\item 
struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}}
\item 
struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}}
\item 
struct \mbox{\hyperlink{structaws__exponential__backoff__retry__options}{aws\+\_\+exponential\+\_\+backoff\+\_\+retry\+\_\+options}}
\item 
struct \mbox{\hyperlink{structaws__standard__retry__options}{aws\+\_\+standard\+\_\+retry\+\_\+options}}
\end{DoxyCompactItemize}
\doxysubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef void() \mbox{\hyperlink{retry__strategy_8h_a840055993c2a9788207792f45db2e27f}{aws\+\_\+retry\+\_\+strategy\+\_\+on\+\_\+retry\+\_\+token\+\_\+acquired\+\_\+fn}}(struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}} $\ast$retry\+\_\+strategy, int \mbox{\hyperlink{channel__handler__test_8c_a7d16b1c68c87cec009d972e79abfba78}{error\+\_\+code}}, struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a3f037ea767197698bc0b4c14fa155431}{token}}, void $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_af1abaca9a982b3cdb0b118914416c39b}{user\+\_\+data}})
\item 
typedef void() \mbox{\hyperlink{retry__strategy_8h_ade4a870a92bb428e8688ec1c07273220}{aws\+\_\+retry\+\_\+strategy\+\_\+on\+\_\+retry\+\_\+ready\+\_\+fn}}(struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a3f037ea767197698bc0b4c14fa155431}{token}}, int \mbox{\hyperlink{channel__handler__test_8c_a7d16b1c68c87cec009d972e79abfba78}{error\+\_\+code}}, void $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_af1abaca9a982b3cdb0b118914416c39b}{user\+\_\+data}})
\end{DoxyCompactItemize}
\doxysubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \mbox{\hyperlink{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0c}{aws\+\_\+retry\+\_\+error\+\_\+type}} \{ \mbox{\hyperlink{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0caac26e05a8ef7994a7690b1482dda89ac}{AWS\+\_\+\+RETRY\+\_\+\+ERROR\+\_\+\+TYPE\+\_\+\+TRANSIENT}}
, \mbox{\hyperlink{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0ca5020ebb2f91809211f484b6e8b94f3f4}{AWS\+\_\+\+RETRY\+\_\+\+ERROR\+\_\+\+TYPE\+\_\+\+THROTTLING}}
, \mbox{\hyperlink{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0ca3df5173a0d4dcb0a9fee714754587f94}{AWS\+\_\+\+RETRY\+\_\+\+ERROR\+\_\+\+TYPE\+\_\+\+SERVER\+\_\+\+ERROR}}
, \mbox{\hyperlink{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0ca47b0edab8d75d0678f4743ef36529cfa}{AWS\+\_\+\+RETRY\+\_\+\+ERROR\+\_\+\+TYPE\+\_\+\+CLIENT\+\_\+\+ERROR}}
 \}
\item 
enum \mbox{\hyperlink{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4}{aws\+\_\+exponential\+\_\+backoff\+\_\+jitter\+\_\+mode}} \{ \mbox{\hyperlink{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4a1bf3d8c55077d0c42566172ea773e29d}{AWS\+\_\+\+EXPONENTIAL\+\_\+\+BACKOFF\+\_\+\+JITTER\+\_\+\+DEFAULT}}
, \mbox{\hyperlink{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4ad35c426b5f1d38b9d73e269d5d3469a5}{AWS\+\_\+\+EXPONENTIAL\+\_\+\+BACKOFF\+\_\+\+JITTER\+\_\+\+NONE}}
, \mbox{\hyperlink{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4a25b62d772d46662fe44cc1e48219ad6f}{AWS\+\_\+\+EXPONENTIAL\+\_\+\+BACKOFF\+\_\+\+JITTER\+\_\+\+FULL}}
, \mbox{\hyperlink{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4afa14159a985f45394ef1837c1bf2d866}{AWS\+\_\+\+EXPONENTIAL\+\_\+\+BACKOFF\+\_\+\+JITTER\+\_\+\+DECORRELATED}}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{macros_8h_ab6f66af8231eba5da061b9ada0d29bad}{AWS\+\_\+\+EXTERN\+\_\+\+C\+\_\+\+BEGIN}} \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} void \mbox{\hyperlink{retry__strategy_8h_a873944178f109ca1607525dd96011cb9}{aws\+\_\+retry\+\_\+strategy\+\_\+acquire}} (struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}} $\ast$retry\+\_\+strategy)
\item 
\mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} void \mbox{\hyperlink{retry__strategy_8h_a622bfe5602501414d1aed990a4b6e0ad}{aws\+\_\+retry\+\_\+strategy\+\_\+release}} (struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}} $\ast$retry\+\_\+strategy)
\item 
\mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} int \mbox{\hyperlink{retry__strategy_8h_a9e5b94bc4256a8cdc498481176fe9a32}{aws\+\_\+retry\+\_\+strategy\+\_\+acquire\+\_\+retry\+\_\+token}} (struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}} $\ast$retry\+\_\+strategy, const struct \mbox{\hyperlink{structaws__byte__cursor}{aws\+\_\+byte\+\_\+cursor}} $\ast$partition\+\_\+id, \mbox{\hyperlink{retry__strategy_8h_a840055993c2a9788207792f45db2e27f}{aws\+\_\+retry\+\_\+strategy\+\_\+on\+\_\+retry\+\_\+token\+\_\+acquired\+\_\+fn}} $\ast$on\+\_\+acquired, void $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_af1abaca9a982b3cdb0b118914416c39b}{user\+\_\+data}}, uint64\+\_\+t timeout\+\_\+ms)
\item 
\mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} int \mbox{\hyperlink{retry__strategy_8h_ae54ea9ff39ddd2a21c87f4ef3e6111d5}{aws\+\_\+retry\+\_\+strategy\+\_\+schedule\+\_\+retry}} (struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a3f037ea767197698bc0b4c14fa155431}{token}}, enum \mbox{\hyperlink{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0c}{aws\+\_\+retry\+\_\+error\+\_\+type}} error\+\_\+type, \mbox{\hyperlink{retry__strategy_8h_ade4a870a92bb428e8688ec1c07273220}{aws\+\_\+retry\+\_\+strategy\+\_\+on\+\_\+retry\+\_\+ready\+\_\+fn}} $\ast$retry\+\_\+ready, void $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_af1abaca9a982b3cdb0b118914416c39b}{user\+\_\+data}})
\item 
\mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} int \mbox{\hyperlink{retry__strategy_8h_a19f32fa855a56b5234d8abd40fa9922e}{aws\+\_\+retry\+\_\+token\+\_\+record\+\_\+success}} (struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a3f037ea767197698bc0b4c14fa155431}{token}})
\item 
\mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} void \mbox{\hyperlink{retry__strategy_8h_a7d2534a49d742270a24a7483e176da9a}{aws\+\_\+retry\+\_\+token\+\_\+acquire}} (struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a3f037ea767197698bc0b4c14fa155431}{token}})
\item 
\mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} void \mbox{\hyperlink{retry__strategy_8h_a99f18334e9edacf4b6d0e67e28c87955}{aws\+\_\+retry\+\_\+token\+\_\+release}} (struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a3f037ea767197698bc0b4c14fa155431}{token}})
\item 
\mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}} $\ast$ \mbox{\hyperlink{retry__strategy_8h_add4d5f38922a24014a74b58998527ef1}{aws\+\_\+retry\+\_\+strategy\+\_\+new\+\_\+exponential\+\_\+backoff}} (struct \mbox{\hyperlink{structaws__allocator}{aws\+\_\+allocator}} $\ast$\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}}, const struct \mbox{\hyperlink{structaws__exponential__backoff__retry__options}{aws\+\_\+exponential\+\_\+backoff\+\_\+retry\+\_\+options}} $\ast$\mbox{\hyperlink{s2n__client__key__recv__fuzz__test_8c_a7d70bb7bed95daae1233293126bb9523}{config}})
\item 
\mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}} $\ast$ \mbox{\hyperlink{retry__strategy_8h_a97ad1815c4d84da1651ef5d69ded9b3c}{aws\+\_\+retry\+\_\+strategy\+\_\+new\+\_\+standard}} (struct \mbox{\hyperlink{structaws__allocator}{aws\+\_\+allocator}} $\ast$\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}}, const struct \mbox{\hyperlink{structaws__standard__retry__options}{aws\+\_\+standard\+\_\+retry\+\_\+options}} $\ast$\mbox{\hyperlink{s2n__client__key__recv__fuzz__test_8c_a7d70bb7bed95daae1233293126bb9523}{config}})
\end{DoxyCompactItemize}


\doxysubsection{Typedef Documentation}
\mbox{\Hypertarget{retry__strategy_8h_ade4a870a92bb428e8688ec1c07273220}\label{retry__strategy_8h_ade4a870a92bb428e8688ec1c07273220}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_strategy\_on\_retry\_ready\_fn@{aws\_retry\_strategy\_on\_retry\_ready\_fn}}
\index{aws\_retry\_strategy\_on\_retry\_ready\_fn@{aws\_retry\_strategy\_on\_retry\_ready\_fn}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_strategy\_on\_retry\_ready\_fn}{aws\_retry\_strategy\_on\_retry\_ready\_fn}}
{\footnotesize\ttfamily typedef void() aws\+\_\+retry\+\_\+strategy\+\_\+on\+\_\+retry\+\_\+ready\+\_\+fn(struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a3f037ea767197698bc0b4c14fa155431}{token}}, int \mbox{\hyperlink{channel__handler__test_8c_a7d16b1c68c87cec009d972e79abfba78}{error\+\_\+code}}, void $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_af1abaca9a982b3cdb0b118914416c39b}{user\+\_\+data}})}

Invoked after a successful call to \mbox{\hyperlink{retry__strategy_8h_ae54ea9ff39ddd2a21c87f4ef3e6111d5}{aws\+\_\+retry\+\_\+strategy\+\_\+schedule\+\_\+retry()}}. This function will always be invoked if and only if \mbox{\hyperlink{retry__strategy_8h_ae54ea9ff39ddd2a21c87f4ef3e6111d5}{aws\+\_\+retry\+\_\+strategy\+\_\+schedule\+\_\+retry()}} returns AWS\+\_\+\+OP\+\_\+\+SUCCESS. It will never be invoked synchronously from \mbox{\hyperlink{retry__strategy_8h_ae54ea9ff39ddd2a21c87f4ef3e6111d5}{aws\+\_\+retry\+\_\+strategy\+\_\+schedule\+\_\+retry()}}. After attempting the operation, either call \mbox{\hyperlink{retry__strategy_8h_ae54ea9ff39ddd2a21c87f4ef3e6111d5}{aws\+\_\+retry\+\_\+strategy\+\_\+schedule\+\_\+retry()}} with an aws\+\_\+retry\+\_\+error\+\_\+type or call \mbox{\hyperlink{retry__strategy_8h_a19f32fa855a56b5234d8abd40fa9922e}{aws\+\_\+retry\+\_\+token\+\_\+record\+\_\+success()}} and then release the token via. \mbox{\hyperlink{retry__strategy_8h_a99f18334e9edacf4b6d0e67e28c87955}{aws\+\_\+retry\+\_\+token\+\_\+release()}}. \mbox{\Hypertarget{retry__strategy_8h_a840055993c2a9788207792f45db2e27f}\label{retry__strategy_8h_a840055993c2a9788207792f45db2e27f}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_strategy\_on\_retry\_token\_acquired\_fn@{aws\_retry\_strategy\_on\_retry\_token\_acquired\_fn}}
\index{aws\_retry\_strategy\_on\_retry\_token\_acquired\_fn@{aws\_retry\_strategy\_on\_retry\_token\_acquired\_fn}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_strategy\_on\_retry\_token\_acquired\_fn}{aws\_retry\_strategy\_on\_retry\_token\_acquired\_fn}}
{\footnotesize\ttfamily typedef void() aws\+\_\+retry\+\_\+strategy\+\_\+on\+\_\+retry\+\_\+token\+\_\+acquired\+\_\+fn(struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}} $\ast$retry\+\_\+strategy, int \mbox{\hyperlink{channel__handler__test_8c_a7d16b1c68c87cec009d972e79abfba78}{error\+\_\+code}}, struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a3f037ea767197698bc0b4c14fa155431}{token}}, void $\ast$\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_af1abaca9a982b3cdb0b118914416c39b}{user\+\_\+data}})}

Invoked upon the acquisition, or failure to acquire a retry token. This function will always be invoked if and only if \mbox{\hyperlink{retry__strategy_8h_a9e5b94bc4256a8cdc498481176fe9a32}{aws\+\_\+retry\+\_\+strategy\+\_\+acquire\+\_\+retry\+\_\+token()}} returns AWS\+\_\+\+OP\+\_\+\+SUCCESS. It will never be invoked synchronously from \mbox{\hyperlink{retry__strategy_8h_a9e5b94bc4256a8cdc498481176fe9a32}{aws\+\_\+retry\+\_\+strategy\+\_\+acquire\+\_\+retry\+\_\+token()}}. Token will always be NULL if error\+\_\+code is non-\/zero, and vice-\/versa. If token is non-\/null, it will have a reference count of 1, and you must call \mbox{\hyperlink{retry__strategy_8h_a99f18334e9edacf4b6d0e67e28c87955}{aws\+\_\+retry\+\_\+token\+\_\+release()}} on it later. See the comments for aws\+\_\+retry\+\_\+strategy\+\_\+on\+\_\+retry\+\_\+ready\+\_\+fn for more info. 

\doxysubsection{Enumeration Type Documentation}
\mbox{\Hypertarget{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4}\label{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_exponential\_backoff\_jitter\_mode@{aws\_exponential\_backoff\_jitter\_mode}}
\index{aws\_exponential\_backoff\_jitter\_mode@{aws\_exponential\_backoff\_jitter\_mode}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_exponential\_backoff\_jitter\_mode}{aws\_exponential\_backoff\_jitter\_mode}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4}{aws\+\_\+exponential\+\_\+backoff\+\_\+jitter\+\_\+mode}}}

Jitter mode for exponential backoff.

For a great writeup on these options see\+: \href{https://aws.amazon.com/blogs/architecture/exponential-backoff-and-jitter/}{\texttt{ https\+://aws.\+amazon.\+com/blogs/architecture/exponential-\/backoff-\/and-\/jitter/}} \begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_DEFAULT@{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_DEFAULT}!retry\_strategy.h@{retry\_strategy.h}}\index{retry\_strategy.h@{retry\_strategy.h}!AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_DEFAULT@{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_DEFAULT}}}\mbox{\Hypertarget{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4a1bf3d8c55077d0c42566172ea773e29d}\label{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4a1bf3d8c55077d0c42566172ea773e29d}} 
AWS\+\_\+\+EXPONENTIAL\+\_\+\+BACKOFF\+\_\+\+JITTER\+\_\+\+DEFAULT&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_NONE@{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_NONE}!retry\_strategy.h@{retry\_strategy.h}}\index{retry\_strategy.h@{retry\_strategy.h}!AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_NONE@{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_NONE}}}\mbox{\Hypertarget{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4ad35c426b5f1d38b9d73e269d5d3469a5}\label{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4ad35c426b5f1d38b9d73e269d5d3469a5}} 
AWS\+\_\+\+EXPONENTIAL\+\_\+\+BACKOFF\+\_\+\+JITTER\+\_\+\+NONE&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_FULL@{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_FULL}!retry\_strategy.h@{retry\_strategy.h}}\index{retry\_strategy.h@{retry\_strategy.h}!AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_FULL@{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_FULL}}}\mbox{\Hypertarget{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4a25b62d772d46662fe44cc1e48219ad6f}\label{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4a25b62d772d46662fe44cc1e48219ad6f}} 
AWS\+\_\+\+EXPONENTIAL\+\_\+\+BACKOFF\+\_\+\+JITTER\+\_\+\+FULL&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_DECORRELATED@{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_DECORRELATED}!retry\_strategy.h@{retry\_strategy.h}}\index{retry\_strategy.h@{retry\_strategy.h}!AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_DECORRELATED@{AWS\_EXPONENTIAL\_BACKOFF\_JITTER\_DECORRELATED}}}\mbox{\Hypertarget{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4afa14159a985f45394ef1837c1bf2d866}\label{retry__strategy_8h_a314f9a25f2e99a18e52c65ffd320b6c4afa14159a985f45394ef1837c1bf2d866}} 
AWS\+\_\+\+EXPONENTIAL\+\_\+\+BACKOFF\+\_\+\+JITTER\+\_\+\+DECORRELATED&\\
\hline

\end{DoxyEnumFields}
\mbox{\Hypertarget{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0c}\label{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0c}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_error\_type@{aws\_retry\_error\_type}}
\index{aws\_retry\_error\_type@{aws\_retry\_error\_type}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_error\_type}{aws\_retry\_error\_type}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0c}{aws\+\_\+retry\+\_\+error\+\_\+type}}}

\begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{AWS\_RETRY\_ERROR\_TYPE\_TRANSIENT@{AWS\_RETRY\_ERROR\_TYPE\_TRANSIENT}!retry\_strategy.h@{retry\_strategy.h}}\index{retry\_strategy.h@{retry\_strategy.h}!AWS\_RETRY\_ERROR\_TYPE\_TRANSIENT@{AWS\_RETRY\_ERROR\_TYPE\_TRANSIENT}}}\mbox{\Hypertarget{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0caac26e05a8ef7994a7690b1482dda89ac}\label{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0caac26e05a8ef7994a7690b1482dda89ac}} 
AWS\+\_\+\+RETRY\+\_\+\+ERROR\+\_\+\+TYPE\+\_\+\+TRANSIENT&This is a connection level error such as a socket timeout, socket connect error, tls negotiation timeout etc... Typically these should never be applied for non-\/idempotent request types since in this scenario, it\textquotesingle{}s impossible to know whether the operation had a side effect on the server. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{AWS\_RETRY\_ERROR\_TYPE\_THROTTLING@{AWS\_RETRY\_ERROR\_TYPE\_THROTTLING}!retry\_strategy.h@{retry\_strategy.h}}\index{retry\_strategy.h@{retry\_strategy.h}!AWS\_RETRY\_ERROR\_TYPE\_THROTTLING@{AWS\_RETRY\_ERROR\_TYPE\_THROTTLING}}}\mbox{\Hypertarget{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0ca5020ebb2f91809211f484b6e8b94f3f4}\label{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0ca5020ebb2f91809211f484b6e8b94f3f4}} 
AWS\+\_\+\+RETRY\+\_\+\+ERROR\+\_\+\+TYPE\+\_\+\+THROTTLING&This is an error where the server explicitly told the client to back off, such as a 429 or 503 Http error. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{AWS\_RETRY\_ERROR\_TYPE\_SERVER\_ERROR@{AWS\_RETRY\_ERROR\_TYPE\_SERVER\_ERROR}!retry\_strategy.h@{retry\_strategy.h}}\index{retry\_strategy.h@{retry\_strategy.h}!AWS\_RETRY\_ERROR\_TYPE\_SERVER\_ERROR@{AWS\_RETRY\_ERROR\_TYPE\_SERVER\_ERROR}}}\mbox{\Hypertarget{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0ca3df5173a0d4dcb0a9fee714754587f94}\label{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0ca3df5173a0d4dcb0a9fee714754587f94}} 
AWS\+\_\+\+RETRY\+\_\+\+ERROR\+\_\+\+TYPE\+\_\+\+SERVER\+\_\+\+ERROR&This is a server error that isn\textquotesingle{}t explicitly throttling but is considered by the client to be something that should be retried. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{AWS\_RETRY\_ERROR\_TYPE\_CLIENT\_ERROR@{AWS\_RETRY\_ERROR\_TYPE\_CLIENT\_ERROR}!retry\_strategy.h@{retry\_strategy.h}}\index{retry\_strategy.h@{retry\_strategy.h}!AWS\_RETRY\_ERROR\_TYPE\_CLIENT\_ERROR@{AWS\_RETRY\_ERROR\_TYPE\_CLIENT\_ERROR}}}\mbox{\Hypertarget{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0ca47b0edab8d75d0678f4743ef36529cfa}\label{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0ca47b0edab8d75d0678f4743ef36529cfa}} 
AWS\+\_\+\+RETRY\+\_\+\+ERROR\+\_\+\+TYPE\+\_\+\+CLIENT\+\_\+\+ERROR&Doesn\textquotesingle{}t count against any budgets. This could be something like a 401 challenge in Http. \\
\hline

\end{DoxyEnumFields}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{retry__strategy_8h_a873944178f109ca1607525dd96011cb9}\label{retry__strategy_8h_a873944178f109ca1607525dd96011cb9}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_strategy\_acquire@{aws\_retry\_strategy\_acquire}}
\index{aws\_retry\_strategy\_acquire@{aws\_retry\_strategy\_acquire}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_strategy\_acquire()}{aws\_retry\_strategy\_acquire()}}
{\footnotesize\ttfamily \mbox{\hyperlink{macros_8h_ab6f66af8231eba5da061b9ada0d29bad}{AWS\+\_\+\+EXTERN\+\_\+\+C\+\_\+\+BEGIN}} \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} void aws\+\_\+retry\+\_\+strategy\+\_\+acquire (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}} $\ast$}]{retry\+\_\+strategy }\end{DoxyParamCaption})}

Acquire a reference count on retry\+\_\+strategy.

Copyright Amazon.\+com, Inc. or its affiliates. All Rights Reserved. SPDX-\/\+License-\/\+Identifier\+: Apache-\/2.\+0. \mbox{\Hypertarget{retry__strategy_8h_a9e5b94bc4256a8cdc498481176fe9a32}\label{retry__strategy_8h_a9e5b94bc4256a8cdc498481176fe9a32}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_strategy\_acquire\_retry\_token@{aws\_retry\_strategy\_acquire\_retry\_token}}
\index{aws\_retry\_strategy\_acquire\_retry\_token@{aws\_retry\_strategy\_acquire\_retry\_token}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_strategy\_acquire\_retry\_token()}{aws\_retry\_strategy\_acquire\_retry\_token()}}
{\footnotesize\ttfamily \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} int aws\+\_\+retry\+\_\+strategy\+\_\+acquire\+\_\+retry\+\_\+token (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}} $\ast$}]{retry\+\_\+strategy,  }\item[{const struct \mbox{\hyperlink{structaws__byte__cursor}{aws\+\_\+byte\+\_\+cursor}} $\ast$}]{partition\+\_\+id,  }\item[{\mbox{\hyperlink{retry__strategy_8h_a840055993c2a9788207792f45db2e27f}{aws\+\_\+retry\+\_\+strategy\+\_\+on\+\_\+retry\+\_\+token\+\_\+acquired\+\_\+fn}} $\ast$}]{on\+\_\+acquired,  }\item[{void $\ast$}]{user\+\_\+data,  }\item[{uint64\+\_\+t}]{timeout\+\_\+ms }\end{DoxyParamCaption})}

Attempts to acquire a retry token for use with retries. On success, on\+\_\+acquired will be invoked when a token is available, or an error will be returned if the timeout expires. partition\+\_\+id identifies operations that should be grouped together. This allows for more sophisticated strategies such as AIMD and circuit breaker patterns. Pass NULL to use the global partition. \mbox{\Hypertarget{retry__strategy_8h_add4d5f38922a24014a74b58998527ef1}\label{retry__strategy_8h_add4d5f38922a24014a74b58998527ef1}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_strategy\_new\_exponential\_backoff@{aws\_retry\_strategy\_new\_exponential\_backoff}}
\index{aws\_retry\_strategy\_new\_exponential\_backoff@{aws\_retry\_strategy\_new\_exponential\_backoff}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_strategy\_new\_exponential\_backoff()}{aws\_retry\_strategy\_new\_exponential\_backoff()}}
{\footnotesize\ttfamily \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}}$\ast$ aws\+\_\+retry\+\_\+strategy\+\_\+new\+\_\+exponential\+\_\+backoff (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structaws__allocator}{aws\+\_\+allocator}} $\ast$}]{allocator,  }\item[{const struct \mbox{\hyperlink{structaws__exponential__backoff__retry__options}{aws\+\_\+exponential\+\_\+backoff\+\_\+retry\+\_\+options}} $\ast$}]{config }\end{DoxyParamCaption})}

Creates a retry strategy using exponential backoff. This strategy does not perform any bookkeeping on error types and success. There is no circuit breaker functionality in here. See the comments above for \mbox{\hyperlink{structaws__exponential__backoff__retry__options}{aws\+\_\+exponential\+\_\+backoff\+\_\+retry\+\_\+options}}. \mbox{\Hypertarget{retry__strategy_8h_a97ad1815c4d84da1651ef5d69ded9b3c}\label{retry__strategy_8h_a97ad1815c4d84da1651ef5d69ded9b3c}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_strategy\_new\_standard@{aws\_retry\_strategy\_new\_standard}}
\index{aws\_retry\_strategy\_new\_standard@{aws\_retry\_strategy\_new\_standard}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_strategy\_new\_standard()}{aws\_retry\_strategy\_new\_standard()}}
{\footnotesize\ttfamily \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}}$\ast$ aws\+\_\+retry\+\_\+strategy\+\_\+new\+\_\+standard (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structaws__allocator}{aws\+\_\+allocator}} $\ast$}]{allocator,  }\item[{const struct \mbox{\hyperlink{structaws__standard__retry__options}{aws\+\_\+standard\+\_\+retry\+\_\+options}} $\ast$}]{config }\end{DoxyParamCaption})}

This is a retry implementation that cuts off traffic if it\textquotesingle{}s detected that an endpoint partition is having availability problems. This is necessary to keep from making outages worse by scheduling work that\textquotesingle{}s unlikely to succeed yet increases load on an already ailing system.

We do this by creating a bucket for each partition. A partition is an arbitrary specifier. It can be anything\+: a region, a service, a combination of region and service, a literal dns name.... doesn\textquotesingle{}t matter.

Each bucket has a budget for maximum allowed retries. Different types of events carry different weights. Things that indicate an unhealthy partition such as transient errors (timeouts, unhealthy connection etc...) cost more. A retry for any other reason (service sending a 5xx response code) cost a bit less. When a retry is attempted this capacity is leased out to the retry. On success it is released back to the capacity pool. On failure, it remains leased. Operations that succeed without a retry slowly restore the capacity pool.

If a partition runs out of capacity it is assumed unhealthy and retries will be blocked until capacity returns to the pool. To prevent a partition from staying unhealthy after an outage has recovered, new requests that succeed without a retry will increase the capacity slowly ( a new request gets a payback lease of 1, but the lease is never actually deducted from the capacity pool). \mbox{\Hypertarget{retry__strategy_8h_a622bfe5602501414d1aed990a4b6e0ad}\label{retry__strategy_8h_a622bfe5602501414d1aed990a4b6e0ad}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_strategy\_release@{aws\_retry\_strategy\_release}}
\index{aws\_retry\_strategy\_release@{aws\_retry\_strategy\_release}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_strategy\_release()}{aws\_retry\_strategy\_release()}}
{\footnotesize\ttfamily \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} void aws\+\_\+retry\+\_\+strategy\+\_\+release (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structaws__retry__strategy}{aws\+\_\+retry\+\_\+strategy}} $\ast$}]{retry\+\_\+strategy }\end{DoxyParamCaption})}

Releases a reference count on retry\+\_\+strategy. \mbox{\Hypertarget{retry__strategy_8h_ae54ea9ff39ddd2a21c87f4ef3e6111d5}\label{retry__strategy_8h_ae54ea9ff39ddd2a21c87f4ef3e6111d5}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_strategy\_schedule\_retry@{aws\_retry\_strategy\_schedule\_retry}}
\index{aws\_retry\_strategy\_schedule\_retry@{aws\_retry\_strategy\_schedule\_retry}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_strategy\_schedule\_retry()}{aws\_retry\_strategy\_schedule\_retry()}}
{\footnotesize\ttfamily \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} int aws\+\_\+retry\+\_\+strategy\+\_\+schedule\+\_\+retry (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$}]{token,  }\item[{enum \mbox{\hyperlink{retry__strategy_8h_af89c6cafd32c7015ca7157a0c36ecb0c}{aws\+\_\+retry\+\_\+error\+\_\+type}}}]{error\+\_\+type,  }\item[{\mbox{\hyperlink{retry__strategy_8h_ade4a870a92bb428e8688ec1c07273220}{aws\+\_\+retry\+\_\+strategy\+\_\+on\+\_\+retry\+\_\+ready\+\_\+fn}} $\ast$}]{retry\+\_\+ready,  }\item[{void $\ast$}]{user\+\_\+data }\end{DoxyParamCaption})}

Schedules a retry based on the backoff and token based strategies. retry\+\_\+ready is invoked when the retry is either ready for execution or if it has been canceled due to application shutdown.

This function can return an error to reject the retry attempt if, for example, a circuit breaker has opened. If this occurs users should fail their calls back to their callers.

error\+\_\+type is used for book keeping. See the comments above for aws\+\_\+retry\+\_\+error\+\_\+type. \mbox{\Hypertarget{retry__strategy_8h_a7d2534a49d742270a24a7483e176da9a}\label{retry__strategy_8h_a7d2534a49d742270a24a7483e176da9a}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_token\_acquire@{aws\_retry\_token\_acquire}}
\index{aws\_retry\_token\_acquire@{aws\_retry\_token\_acquire}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_token\_acquire()}{aws\_retry\_token\_acquire()}}
{\footnotesize\ttfamily \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} void aws\+\_\+retry\+\_\+token\+\_\+acquire (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$}]{token }\end{DoxyParamCaption})}

Increments reference count for token. This should be called any time you seat the token to a pointer you own. \mbox{\Hypertarget{retry__strategy_8h_a19f32fa855a56b5234d8abd40fa9922e}\label{retry__strategy_8h_a19f32fa855a56b5234d8abd40fa9922e}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_token\_record\_success@{aws\_retry\_token\_record\_success}}
\index{aws\_retry\_token\_record\_success@{aws\_retry\_token\_record\_success}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_token\_record\_success()}{aws\_retry\_token\_record\_success()}}
{\footnotesize\ttfamily \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} int aws\+\_\+retry\+\_\+token\+\_\+record\+\_\+success (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$}]{token }\end{DoxyParamCaption})}

Records a successful retry. This is used for making future decisions to open up token buckets, AIMD breakers etc... some strategies such as exponential backoff will ignore this, but you should always call it after a successful operation or your system will never recover during an outage. \mbox{\Hypertarget{retry__strategy_8h_a99f18334e9edacf4b6d0e67e28c87955}\label{retry__strategy_8h_a99f18334e9edacf4b6d0e67e28c87955}} 
\index{retry\_strategy.h@{retry\_strategy.h}!aws\_retry\_token\_release@{aws\_retry\_token\_release}}
\index{aws\_retry\_token\_release@{aws\_retry\_token\_release}!retry\_strategy.h@{retry\_strategy.h}}
\doxysubsubsection{\texorpdfstring{aws\_retry\_token\_release()}{aws\_retry\_token\_release()}}
{\footnotesize\ttfamily \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-io_2include_2aws_2io_2_exports_8h_a26db8dfe8d149d3ddd330c792f3e67df}{AWS\+\_\+\+IO\+\_\+\+API}} void aws\+\_\+retry\+\_\+token\+\_\+release (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structaws__retry__token}{aws\+\_\+retry\+\_\+token}} $\ast$}]{token }\end{DoxyParamCaption})}

Releases the reference count for token. This should always be invoked after either calling \mbox{\hyperlink{retry__strategy_8h_ae54ea9ff39ddd2a21c87f4ef3e6111d5}{aws\+\_\+retry\+\_\+strategy\+\_\+schedule\+\_\+retry()}} and failing, or after calling \mbox{\hyperlink{retry__strategy_8h_a19f32fa855a56b5234d8abd40fa9922e}{aws\+\_\+retry\+\_\+token\+\_\+record\+\_\+success()}}. 