\hypertarget{test__case__helper_8h_source}{}\doxysection{test\+\_\+case\+\_\+helper.\+h}
\label{test__case__helper_8h_source}\index{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/cal/tests/test\_case\_helper.h@{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/cal/tests/test\_case\_helper.h}}
\mbox{\hyperlink{test__case__helper_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{cal_8h}{aws/cal/cal.h}}>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{crt_2aws-c-cal_2include_2aws_2cal_2_hash_8h}{aws/cal/hash.h}}>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{crt_2aws-c-cal_2include_2aws_2cal_2_h_m_a_c_8h}{aws/cal/hmac.h}}>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \mbox{\hyperlink{test__case__helper_8h_a42e9bac93a411cc6e173eae848ae2285}{s\_verify\_hmac\_test\_case}}(}
\DoxyCodeLine{10     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__allocator}{aws\_allocator}} *\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}},}
\DoxyCodeLine{11     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} *input,}
\DoxyCodeLine{12     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} *secret,}
\DoxyCodeLine{13     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} *expected,}
\DoxyCodeLine{14     \mbox{\hyperlink{crt_2aws-c-cal_2include_2aws_2cal_2_h_m_a_c_8h_aab6815d6797ca8ea2d161f4300cee717}{aws\_hmac\_new\_fn}} *new\_fn) \{}
\DoxyCodeLine{15 }
\DoxyCodeLine{16     \mbox{\hyperlink{cal_8h_a769ab0cc2d1a53e6d6f501238dedd3c5}{aws\_cal\_library\_init}}(\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}});}
\DoxyCodeLine{17 }
\DoxyCodeLine{18     \textcolor{comment}{/* test all possible segmentation lengths from 1 byte at a time to the entire}}
\DoxyCodeLine{19 \textcolor{comment}{     * input. */}}
\DoxyCodeLine{20     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 1; i < input-\/>\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}}; ++i) \{}
\DoxyCodeLine{21         uint8\_t \mbox{\hyperlink{log__formatter__test_8c_ae73289c5189c80c0661459b0f4743217}{output}}[128] = \{0\};}
\DoxyCodeLine{22         \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__byte__buf}{aws\_byte\_buf}} output\_buf = \mbox{\hyperlink{byte__buf_8h_a22361604f41a2c0a833e59905a3cd49a}{aws\_byte\_buf\_from\_array}}(\mbox{\hyperlink{log__formatter__test_8c_ae73289c5189c80c0661459b0f4743217}{output}}, expected-\/>\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}});}
\DoxyCodeLine{23         output\_buf.\mbox{\hyperlink{structaws__byte__buf_a56a0e80b3f9374df753980bbb66f228d}{len}} = 0;}
\DoxyCodeLine{24 }
\DoxyCodeLine{25         \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__hmac}{aws\_hmac}} *hmac = new\_fn(\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}}, secret);}
\DoxyCodeLine{26         \mbox{\hyperlink{aws__test__harness_8h_a6f5622ca356e1dea11a8b84dd39505ba}{ASSERT\_NOT\_NULL}}(hmac);}
\DoxyCodeLine{27 }
\DoxyCodeLine{28         \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} input\_cpy = *input;}
\DoxyCodeLine{29 }
\DoxyCodeLine{30         \textcolor{keywordflow}{while} (input\_cpy.\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}}) \{}
\DoxyCodeLine{31             \textcolor{keywordtype}{size\_t} max\_advance = input\_cpy.\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}} > i ? i : input\_cpy.\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}};}
\DoxyCodeLine{32             \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} segment = \mbox{\hyperlink{byte__buf_8h_a30c845aea25a22f05ca8f48758e82f34}{aws\_byte\_cursor\_from\_array}}(input\_cpy.\mbox{\hyperlink{structaws__byte__cursor_a824ebfad81da6928a703a04fe80f7bb7}{ptr}}, max\_advance);}
\DoxyCodeLine{33             \mbox{\hyperlink{aws__test__harness_8h_add6cf4f1306c74a90c1449043e26ac07}{ASSERT\_SUCCESS}}(\mbox{\hyperlink{crt_2aws-c-cal_2include_2aws_2cal_2_h_m_a_c_8h_ac746bfe65f840f27f3df5872953a5088}{aws\_hmac\_update}}(hmac, \&segment));}
\DoxyCodeLine{34             \mbox{\hyperlink{byte__buf_8h_af44b403cc3ed6ea15300fab8e7b846f9}{aws\_byte\_cursor\_advance}}(\&input\_cpy, max\_advance);}
\DoxyCodeLine{35         \}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37         \textcolor{keywordtype}{size\_t} truncation\_size = hmac-\/>\mbox{\hyperlink{structaws__hmac_ae971059813760cc37d1d2ae6fd9f9ae3}{digest\_size}} -\/ expected-\/>\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}};}
\DoxyCodeLine{38 }
\DoxyCodeLine{39         \mbox{\hyperlink{aws__test__harness_8h_add6cf4f1306c74a90c1449043e26ac07}{ASSERT\_SUCCESS}}(\mbox{\hyperlink{crt_2aws-c-cal_2include_2aws_2cal_2_h_m_a_c_8h_a99828ddbe88e73866cdd373e41a34bc1}{aws\_hmac\_finalize}}(hmac, \&output\_buf, truncation\_size));}
\DoxyCodeLine{40         \mbox{\hyperlink{aws__test__harness_8h_acb5d0fd5e1fc8b9d6a70e6ffbdb39b1b}{ASSERT\_BIN\_ARRAYS\_EQUALS}}(expected-\/>\mbox{\hyperlink{structaws__byte__cursor_a824ebfad81da6928a703a04fe80f7bb7}{ptr}}, expected-\/>\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}}, output\_buf.\mbox{\hyperlink{structaws__byte__buf_ad3a14c329a969f4895f0023e40261dfe}{buffer}}, output\_buf.\mbox{\hyperlink{structaws__byte__buf_a56a0e80b3f9374df753980bbb66f228d}{len}});}
\DoxyCodeLine{41 }
\DoxyCodeLine{42         \mbox{\hyperlink{crt_2aws-c-cal_2include_2aws_2cal_2_h_m_a_c_8h_a59147dda3b5aaeec212d2c8518dc2349}{aws\_hmac\_destroy}}(hmac);}
\DoxyCodeLine{43     \}}
\DoxyCodeLine{44 }
\DoxyCodeLine{45     \mbox{\hyperlink{cal_8h_a633abf5f87130d66944ab0fb03b90dc7}{aws\_cal\_library\_clean\_up}}();}
\DoxyCodeLine{46 }
\DoxyCodeLine{47     \textcolor{keywordflow}{return} \mbox{\hyperlink{aws-c-common_2include_2aws_2common_2error_8h_a5c0c86c38647f98229becf17743f7cb5}{AWS\_OP\_SUCCESS}};}
\DoxyCodeLine{48 \}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \mbox{\hyperlink{test__case__helper_8h_ad067866943ecf3f6d9b0db5cdd815ebc}{s\_verify\_hash\_test\_case}}(}
\DoxyCodeLine{51     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__allocator}{aws\_allocator}} *\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}},}
\DoxyCodeLine{52     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} *input,}
\DoxyCodeLine{53     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} *expected,}
\DoxyCodeLine{54     \mbox{\hyperlink{crt_2aws-c-cal_2include_2aws_2cal_2_hash_8h_a8156c335c3fb63355fa5a5b9c00535d8}{aws\_hash\_new\_fn}} *new\_fn) \{}
\DoxyCodeLine{55 }
\DoxyCodeLine{56     \mbox{\hyperlink{cal_8h_a769ab0cc2d1a53e6d6f501238dedd3c5}{aws\_cal\_library\_init}}(\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}});}
\DoxyCodeLine{57 }
\DoxyCodeLine{58     \textcolor{comment}{/* test all possible segmentation lengths from 1 byte at a time to the entire}}
\DoxyCodeLine{59 \textcolor{comment}{     * input. */}}
\DoxyCodeLine{60     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 1; i < input-\/>\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}}; ++i) \{}
\DoxyCodeLine{61         uint8\_t \mbox{\hyperlink{log__formatter__test_8c_ae73289c5189c80c0661459b0f4743217}{output}}[128] = \{0\};}
\DoxyCodeLine{62         \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__byte__buf}{aws\_byte\_buf}} output\_buf = \mbox{\hyperlink{byte__buf_8h_a22361604f41a2c0a833e59905a3cd49a}{aws\_byte\_buf\_from\_array}}(\mbox{\hyperlink{log__formatter__test_8c_ae73289c5189c80c0661459b0f4743217}{output}}, expected-\/>\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}});}
\DoxyCodeLine{63         output\_buf.\mbox{\hyperlink{structaws__byte__buf_a56a0e80b3f9374df753980bbb66f228d}{len}} = 0;}
\DoxyCodeLine{64 }
\DoxyCodeLine{65         \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__hash}{aws\_hash}} *hash = new\_fn(\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}});}
\DoxyCodeLine{66         \mbox{\hyperlink{aws__test__harness_8h_a6f5622ca356e1dea11a8b84dd39505ba}{ASSERT\_NOT\_NULL}}(hash);}
\DoxyCodeLine{67 }
\DoxyCodeLine{68         \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} input\_cpy = *input;}
\DoxyCodeLine{69 }
\DoxyCodeLine{70         \textcolor{keywordflow}{while} (input\_cpy.\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}}) \{}
\DoxyCodeLine{71             \textcolor{keywordtype}{size\_t} max\_advance = input\_cpy.\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}} > i ? i : input\_cpy.\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}};}
\DoxyCodeLine{72             \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} segment = \mbox{\hyperlink{byte__buf_8h_a30c845aea25a22f05ca8f48758e82f34}{aws\_byte\_cursor\_from\_array}}(input\_cpy.\mbox{\hyperlink{structaws__byte__cursor_a824ebfad81da6928a703a04fe80f7bb7}{ptr}}, max\_advance);}
\DoxyCodeLine{73             \mbox{\hyperlink{aws__test__harness_8h_add6cf4f1306c74a90c1449043e26ac07}{ASSERT\_SUCCESS}}(\mbox{\hyperlink{crt_2aws-c-cal_2include_2aws_2cal_2_hash_8h_a6fb9b1b052c7eae654e2b0b3bf99c9bb}{aws\_hash\_update}}(hash, \&segment));}
\DoxyCodeLine{74             \mbox{\hyperlink{byte__buf_8h_af44b403cc3ed6ea15300fab8e7b846f9}{aws\_byte\_cursor\_advance}}(\&input\_cpy, max\_advance);}
\DoxyCodeLine{75         \}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77         \textcolor{keywordtype}{size\_t} truncation\_size = hash-\/>\mbox{\hyperlink{structaws__hash_a3fa3a1c94f98156d8c8506cba20835e1}{digest\_size}} -\/ expected-\/>\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}};}
\DoxyCodeLine{78 }
\DoxyCodeLine{79         \mbox{\hyperlink{aws__test__harness_8h_add6cf4f1306c74a90c1449043e26ac07}{ASSERT\_SUCCESS}}(\mbox{\hyperlink{crt_2aws-c-cal_2include_2aws_2cal_2_hash_8h_a135d765bf592cdc5396a33459757916a}{aws\_hash\_finalize}}(hash, \&output\_buf, truncation\_size));}
\DoxyCodeLine{80         \mbox{\hyperlink{aws__test__harness_8h_acb5d0fd5e1fc8b9d6a70e6ffbdb39b1b}{ASSERT\_BIN\_ARRAYS\_EQUALS}}(expected-\/>\mbox{\hyperlink{structaws__byte__cursor_a824ebfad81da6928a703a04fe80f7bb7}{ptr}}, expected-\/>\mbox{\hyperlink{structaws__byte__cursor_aa7f3033ab49f70797d55e1de6afe2965}{len}}, output\_buf.\mbox{\hyperlink{structaws__byte__buf_ad3a14c329a969f4895f0023e40261dfe}{buffer}}, output\_buf.\mbox{\hyperlink{structaws__byte__buf_a56a0e80b3f9374df753980bbb66f228d}{len}});}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         \mbox{\hyperlink{crt_2aws-c-cal_2include_2aws_2cal_2_hash_8h_afb0de255571816215084d89d409476b0}{aws\_hash\_destroy}}(hash);}
\DoxyCodeLine{83     \}}
\DoxyCodeLine{84 }
\DoxyCodeLine{85     \mbox{\hyperlink{cal_8h_a633abf5f87130d66944ab0fb03b90dc7}{aws\_cal\_library\_clean\_up}}();}
\DoxyCodeLine{86 }
\DoxyCodeLine{87     \textcolor{keywordflow}{return} \mbox{\hyperlink{aws-c-common_2include_2aws_2common_2error_8h_a5c0c86c38647f98229becf17743f7cb5}{AWS\_OP\_SUCCESS}};}
\DoxyCodeLine{88 \}}

\end{DoxyCode}
