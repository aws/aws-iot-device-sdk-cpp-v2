\hypertarget{h1__stream_8h_source}{}\doxysection{h1\+\_\+stream.\+h}
\label{h1__stream_8h_source}\index{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/http/include/aws/http/private/h1\_stream.h@{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/http/include/aws/http/private/h1\_stream.h}}
\mbox{\hyperlink{h1__stream_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef AWS\_HTTP\_H1\_STREAM\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define AWS\_HTTP\_H1\_STREAM\_H}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{h1__encoder_8h}{aws/http/private/h1\_encoder.h}}>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{http__impl_8h}{aws/http/private/http\_impl.h}}>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{request__response__impl_8h}{aws/http/private/request\_response\_impl.h}}>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{channel_8h}{aws/io/channel.h}}>}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#ifdef \_MSC\_VER}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#    pragma warning(disable : 4214) }\textcolor{comment}{/* nonstandard extension used: bit field types other than int */}\textcolor{preprocessor}{}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{comment}{/* Simple view of stream's state.}}
\DoxyCodeLine{18 \textcolor{comment}{ * Used to determine whether it's safe for a user to call functions that alter state. */}}
\DoxyCodeLine{19 \textcolor{keyword}{enum} \mbox{\hyperlink{h1__stream_8h_afe0b873cbe48bd8eeea5381d7c3c6b12}{aws\_h1\_stream\_api\_state}} \{}
\DoxyCodeLine{20     \mbox{\hyperlink{h1__stream_8h_afe0b873cbe48bd8eeea5381d7c3c6b12acd3af6e7c8ca97f7fa5387d2b0a4a949}{AWS\_H1\_STREAM\_API\_STATE\_INIT}},}
\DoxyCodeLine{21     \mbox{\hyperlink{h1__stream_8h_afe0b873cbe48bd8eeea5381d7c3c6b12aea5e4960d09c58e086afd15d060b48b7}{AWS\_H1\_STREAM\_API\_STATE\_ACTIVE}},}
\DoxyCodeLine{22     \mbox{\hyperlink{h1__stream_8h_afe0b873cbe48bd8eeea5381d7c3c6b12a0446143c7a267949b8d850450791a31c}{AWS\_H1\_STREAM\_API\_STATE\_COMPLETE}},}
\DoxyCodeLine{23 \};}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h1__stream}{aws\_h1\_stream}} \{}
\DoxyCodeLine{26     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__http__stream}{aws\_http\_stream}} \mbox{\hyperlink{structaws__h1__stream_a30db1561fc1a282026cb45c5ca521474}{base}};}
\DoxyCodeLine{27 }
\DoxyCodeLine{28     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__linked__list__node}{aws\_linked\_list\_node}} \mbox{\hyperlink{structaws__h1__stream_a58aa5b86c344be36cbda50c0ebbd9427}{node}};}
\DoxyCodeLine{29 }
\DoxyCodeLine{30     \textcolor{comment}{/* Task that removes items from `synced\_data` and does their on-\/thread work.}}
\DoxyCodeLine{31 \textcolor{comment}{     * Runs once and wait until it's scheduled again.}}
\DoxyCodeLine{32 \textcolor{comment}{     * Any function that wants to schedule this task MUST:}}
\DoxyCodeLine{33 \textcolor{comment}{     * -\/ acquire the synced\_data.lock}}
\DoxyCodeLine{34 \textcolor{comment}{     * -\/ check whether `synced\_data.is\_cross\_thread\_work\_scheduled` was true or false.}}
\DoxyCodeLine{35 \textcolor{comment}{     * -\/ set `synced\_data.is\_cross\_thread\_work\_scheduled = true`}}
\DoxyCodeLine{36 \textcolor{comment}{     * -\/ release synced\_data.lock}}
\DoxyCodeLine{37 \textcolor{comment}{     * -\/ ONLY IF `synced\_data.is\_cross\_thread\_work\_scheduled` CHANGED from false to true:}}
\DoxyCodeLine{38 \textcolor{comment}{     *   -\/ increment the stream's refcount, to keep stream alive until task runs}}
\DoxyCodeLine{39 \textcolor{comment}{     *   -\/ schedule the task}}
\DoxyCodeLine{40 \textcolor{comment}{     */}}
\DoxyCodeLine{41     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__channel__task}{aws\_channel\_task}} \mbox{\hyperlink{structaws__h1__stream_ada241485f005bfd772ac846f53bec2d7}{cross\_thread\_work\_task}};}
\DoxyCodeLine{42 }
\DoxyCodeLine{43     \textcolor{comment}{/* Message (derived from outgoing request or response) to be submitted to encoder */}}
\DoxyCodeLine{44     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h1__encoder__message}{aws\_h1\_encoder\_message}} \mbox{\hyperlink{structaws__h1__stream_af3f52b77fdf76812157597727e661831}{encoder\_message}};}
\DoxyCodeLine{45 }
\DoxyCodeLine{46     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h1__stream_a9cd546115f72e8e1b52b3478fad415d5}{is\_outgoing\_message\_done}};}
\DoxyCodeLine{47 }
\DoxyCodeLine{48     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h1__stream_ad1ed7f62b4c16b4b7f7a7ec7c023d07e}{is\_incoming\_message\_done}};}
\DoxyCodeLine{49     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h1__stream_a1ab5c81093ec38e21d73e07dc9307fd1}{is\_incoming\_head\_done}};}
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{comment}{/* If true, this is the last stream the connection should process.}}
\DoxyCodeLine{52 \textcolor{comment}{     * See RFC-\/7230 Section 6: Connection Management. */}}
\DoxyCodeLine{53     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h1__stream_a03045e130ed9c82bfb21e6de360170e4}{is\_final\_stream}};}
\DoxyCodeLine{54 }
\DoxyCodeLine{55     \textcolor{comment}{/* Buffer for incoming data that needs to stick around. */}}
\DoxyCodeLine{56     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__byte__buf}{aws\_byte\_buf}} \mbox{\hyperlink{structaws__h1__stream_a9f465e4033551aaaa3a7024f0e2a102b}{incoming\_storage\_buf}};}
\DoxyCodeLine{57 }
\DoxyCodeLine{58     \textcolor{keyword}{struct }\{}
\DoxyCodeLine{59         \textcolor{comment}{/* TODO: move most other members in here */}}
\DoxyCodeLine{60 }
\DoxyCodeLine{61         \textcolor{comment}{/* List of `struct aws\_h1\_chunk`, used for chunked encoding.}}
\DoxyCodeLine{62 \textcolor{comment}{         * Encoder completes/frees/pops front chunk when it's done sending. */}}
\DoxyCodeLine{63         \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__linked__list}{aws\_linked\_list}} \mbox{\hyperlink{structaws__h1__stream_a29c540f66ed5851033848291ef8fcb41}{pending\_chunk\_list}};}
\DoxyCodeLine{64 }
\DoxyCodeLine{65         \textcolor{comment}{/* Size of stream's flow-\/control window.}}
\DoxyCodeLine{66 \textcolor{comment}{         * Only body data (not headers, etc) counts against the stream's flow-\/control window. */}}
\DoxyCodeLine{67         uint64\_t \mbox{\hyperlink{structaws__h1__stream_ad8c7c988a9ec9263c02c42b62b9671e3}{stream\_window}};}
\DoxyCodeLine{68 }
\DoxyCodeLine{69         \textcolor{comment}{/* Whether a "{}request handler"{} stream has a response to send.}}
\DoxyCodeLine{70 \textcolor{comment}{         * Has mirror variable in synced\_data */}}
\DoxyCodeLine{71         \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h1__stream_a5a5230e061e28f2cb5b7e064ebfdd55d}{has\_outgoing\_response}} : 1;}
\DoxyCodeLine{72     \} \mbox{\hyperlink{structaws__h1__stream_a8e99f9ed05d2f296707734960131dfac}{thread\_data}};}
\DoxyCodeLine{73 }
\DoxyCodeLine{74     \textcolor{comment}{/* Any thread may touch this data, but the connection's lock must be held.}}
\DoxyCodeLine{75 \textcolor{comment}{     * Sharing a lock is fine because it's rare for an HTTP/1 connection}}
\DoxyCodeLine{76 \textcolor{comment}{     * to have more than one stream at a time. */}}
\DoxyCodeLine{77     \textcolor{keyword}{struct }\{}
\DoxyCodeLine{78         \textcolor{comment}{/* List of `struct aws\_h1\_chunk` which have been submitted by user,}}
\DoxyCodeLine{79 \textcolor{comment}{         * but haven't yet moved to encoder\_message.pending\_chunk\_list where the encoder will find them. */}}
\DoxyCodeLine{80         \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__linked__list}{aws\_linked\_list}} \mbox{\hyperlink{structaws__h1__stream_a29c540f66ed5851033848291ef8fcb41}{pending\_chunk\_list}};}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         \textcolor{keyword}{enum} \mbox{\hyperlink{h1__stream_8h_afe0b873cbe48bd8eeea5381d7c3c6b12}{aws\_h1\_stream\_api\_state}} \mbox{\hyperlink{structaws__h1__stream_af6367fa3389e72012807f9da032b13a5}{api\_state}};}
\DoxyCodeLine{83 }
\DoxyCodeLine{84         \textcolor{comment}{/* Sum of all aws\_http\_stream\_update\_window() calls that haven't yet moved to thread\_data.stream\_window */}}
\DoxyCodeLine{85         uint64\_t \mbox{\hyperlink{structaws__h1__stream_a20f4422ceda04750e11273c9322c4d30}{pending\_window\_update}};}
\DoxyCodeLine{86 }
\DoxyCodeLine{87         \textcolor{comment}{/* See `cross\_thread\_work\_task` */}}
\DoxyCodeLine{88         \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h1__stream_aef15138e80aed9588343ba3b8696a8d3}{is\_cross\_thread\_work\_task\_scheduled}} : 1;}
\DoxyCodeLine{89 }
\DoxyCodeLine{90         \textcolor{comment}{/* Whether a "{}request handler"{} stream has a response to send.}}
\DoxyCodeLine{91 \textcolor{comment}{         * Has mirror variable in thread\_data */}}
\DoxyCodeLine{92         \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h1__stream_a5a5230e061e28f2cb5b7e064ebfdd55d}{has\_outgoing\_response}} : 1;}
\DoxyCodeLine{93 }
\DoxyCodeLine{94         \textcolor{comment}{/* Whether the outgoing message is using chunked encoding */}}
\DoxyCodeLine{95         \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h1__stream_a0f6dfb674018b4e451bff93ecfabe9a4}{using\_chunked\_encoding}} : 1;}
\DoxyCodeLine{96     \} \mbox{\hyperlink{structaws__h1__stream_a455c9476a7d982827defdaaded2083fa}{synced\_data}};}
\DoxyCodeLine{97 \};}
\DoxyCodeLine{98 }
\DoxyCodeLine{99 \textcolor{comment}{/* DO NOT export functions below. They're only used by other .c files in this library */}}
\DoxyCodeLine{100 }
\DoxyCodeLine{101 \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h1__stream}{aws\_h1\_stream}} *\mbox{\hyperlink{h1__stream_8h_ab43a30cfb7de2c793f229a203ba79039}{aws\_h1\_stream\_new\_request}}(}
\DoxyCodeLine{102     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__connection}{aws\_http\_connection}} *client\_connection,}
\DoxyCodeLine{103     \textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__make__request__options}{aws\_http\_make\_request\_options}} *options);}
\DoxyCodeLine{104 }
\DoxyCodeLine{105 \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h1__stream}{aws\_h1\_stream}} *\mbox{\hyperlink{h1__stream_8h_a599462d82f601644f7fe929ec5cce257}{aws\_h1\_stream\_new\_request\_handler}}(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__request__handler__options}{aws\_http\_request\_handler\_options}} *options);}
\DoxyCodeLine{106 }
\DoxyCodeLine{107 \textcolor{keywordtype}{int} \mbox{\hyperlink{h1__stream_8h_a49374a365ecc247718b30a3b171fac22}{aws\_h1\_stream\_activate}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__stream}{aws\_http\_stream}} *stream);}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \textcolor{keywordtype}{int} \mbox{\hyperlink{h1__stream_8h_a1775a72eedb6b9dc182eafee64a14fe9}{aws\_h1\_stream\_send\_response}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__stream}{aws\_h1\_stream}} *stream, \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__message}{aws\_http\_message}} *response);}
\DoxyCodeLine{110 }
\DoxyCodeLine{111 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* AWS\_HTTP\_H1\_STREAM\_H */}\textcolor{preprocessor}{}}

\end{DoxyCode}
