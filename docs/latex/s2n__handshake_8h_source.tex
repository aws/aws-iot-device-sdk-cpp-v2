\hypertarget{s2n__handshake_8h_source}{}\doxysection{s2n\+\_\+handshake.\+h}
\label{s2n__handshake_8h_source}\index{crt/aws-\/crt-\/cpp/crt/s2n/tls/s2n\_handshake.h@{crt/aws-\/crt-\/cpp/crt/s2n/tls/s2n\_handshake.h}}
\mbox{\hyperlink{s2n__handshake_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ * Licensed under the Apache License, Version 2.0 (the "{}License"{}).}}
\DoxyCodeLine{5 \textcolor{comment}{ * You may not use this file except in compliance with the License.}}
\DoxyCodeLine{6 \textcolor{comment}{ * A copy of the License is located at}}
\DoxyCodeLine{7 \textcolor{comment}{ *}}
\DoxyCodeLine{8 \textcolor{comment}{ *  http://aws.amazon.com/apache2.0}}
\DoxyCodeLine{9 \textcolor{comment}{ *}}
\DoxyCodeLine{10 \textcolor{comment}{ * or in the "{}license"{} file accompanying this file. This file is distributed}}
\DoxyCodeLine{11 \textcolor{comment}{ * on an "{}AS IS"{} BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either}}
\DoxyCodeLine{12 \textcolor{comment}{ * express or implied. See the License for the specific language governing}}
\DoxyCodeLine{13 \textcolor{comment}{ * permissions and limitations under the License.}}
\DoxyCodeLine{14 \textcolor{comment}{ */}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{stdint_8h}{stdint.h}}>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{s2n_8h}{s2n.h}}>}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{tls_2s2n__crypto_8h}{tls/s2n\_crypto.h}}"{}}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{s2n__signature__algorithms_8h}{tls/s2n\_signature\_algorithms.h}}"{}}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{s2n__tls__parameters_8h}{tls/s2n\_tls\_parameters.h}}"{}}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{s2n__stuffer_8h}{stuffer/s2n\_stuffer.h}}"{}}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{s2n__certificate_8h}{crypto/s2n\_certificate.h}}"{}}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{s2n__hash_8h}{crypto/s2n\_hash.h}}"{}}}
\DoxyCodeLine{29 }
\DoxyCodeLine{30 \textcolor{comment}{/* From RFC 8446: https://tools.ietf.org/html/rfc8446\#appendix-\/B.3 */}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#define TLS\_HELLO\_REQUEST              0}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#define TLS\_CLIENT\_HELLO               1}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#define TLS\_SERVER\_HELLO               2}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#define TLS\_SERVER\_NEW\_SESSION\_TICKET  4}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#define TLS\_ENCRYPTED\_EXTENSIONS       8}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#define TLS\_CERTIFICATE               11}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#define TLS\_SERVER\_KEY                12}}
\DoxyCodeLine{38 \textcolor{preprocessor}{\#define TLS\_CERT\_REQ                  13}}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#define TLS\_SERVER\_HELLO\_DONE         14}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#define TLS\_CERT\_VERIFY               15}}
\DoxyCodeLine{41 \textcolor{preprocessor}{\#define TLS\_CLIENT\_KEY                16}}
\DoxyCodeLine{42 \textcolor{preprocessor}{\#define TLS\_FINISHED                  20}}
\DoxyCodeLine{43 \textcolor{preprocessor}{\#define TLS\_SERVER\_CERT\_STATUS        22}}
\DoxyCodeLine{44 \textcolor{preprocessor}{\#define TLS\_SERVER\_SESSION\_LOOKUP     23}}
\DoxyCodeLine{45 \textcolor{preprocessor}{\#define TLS\_KEY\_UPDATE                24}}
\DoxyCodeLine{46 \textcolor{preprocessor}{\#define TLS\_MESSAGE\_HASH             254}}
\DoxyCodeLine{47 }
\DoxyCodeLine{48 \textcolor{comment}{/* This is the list of message types that we support */}}
\DoxyCodeLine{49 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{}
\DoxyCodeLine{50     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca0c8da6c451065bed79ea70684e6f3fca}{CLIENT\_HELLO}}=0,}
\DoxyCodeLine{51     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca28914d3bb26ec8c2bd2d5ad9781cbf8c}{SERVER\_HELLO}},}
\DoxyCodeLine{52     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca4fa0b8ef81392fad2cfb9dc57309edbd}{SERVER\_CERT}},}
\DoxyCodeLine{53     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557cae52bc4016214323914340116903aacc2}{SERVER\_NEW\_SESSION\_TICKET}},}
\DoxyCodeLine{54     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557cabcaf9c1fed1de9b455ba3b260f1891e1}{SERVER\_CERT\_STATUS}},}
\DoxyCodeLine{55     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca4c8761df0519724fe202e8093278925b}{SERVER\_KEY}},}
\DoxyCodeLine{56     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca4ba20e86c79041ff8bc04d57da4850a2}{SERVER\_CERT\_REQ}},}
\DoxyCodeLine{57     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca27c9351168f8b8c04e98d7bfb5f1aef9}{SERVER\_HELLO\_DONE}},}
\DoxyCodeLine{58     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557caf70fb6b67e18c60d70d9a7749974234b}{CLIENT\_CERT}},}
\DoxyCodeLine{59     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557caad5372bce033ae01cf194fea810961ab}{CLIENT\_KEY}},}
\DoxyCodeLine{60     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557caf7112e32da168252c9961359a7aff33f}{CLIENT\_CERT\_VERIFY}},}
\DoxyCodeLine{61     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca79b2332e05cbf65a699a00fc65df797a}{CLIENT\_CHANGE\_CIPHER\_SPEC}},}
\DoxyCodeLine{62     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557cab567f0940aaa3b7a15d127767c31fa19}{CLIENT\_FINISHED}},}
\DoxyCodeLine{63     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca8c4c29243512fe560bc5d219f9546ea7}{SERVER\_CHANGE\_CIPHER\_SPEC}},}
\DoxyCodeLine{64     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca2dd425fc48253faf37d05196d691f4fd}{SERVER\_FINISHED}},}
\DoxyCodeLine{65 }
\DoxyCodeLine{66     \textcolor{comment}{/* TLS1.3 message types. Defined: https://tools.ietf.org/html/rfc8446\#appendix-\/B.3 */}}
\DoxyCodeLine{67     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca735cac9d38560822bfb4162a266270dc}{ENCRYPTED\_EXTENSIONS}},}
\DoxyCodeLine{68     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca246b64f82d95901f4aeb1b43a4f32c0c}{SERVER\_CERT\_VERIFY}},}
\DoxyCodeLine{69     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557ca31da41372088344ae69e4e5ffe516d87}{HELLO\_RETRY\_MSG}},}
\DoxyCodeLine{70 }
\DoxyCodeLine{71     \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557cae5600c9ebf3ad742718c2ba003539a45}{APPLICATION\_DATA}},}
\DoxyCodeLine{72 \} \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557c}{message\_type\_t}};}
\DoxyCodeLine{73 }
\DoxyCodeLine{74 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{}
\DoxyCodeLine{75     \mbox{\hyperlink{s2n__handshake_8h_a2558e05cc7c0ed1ca0078f77b2cd800ba34f593c781cb37a95520ba780d5772fa}{S2N\_ASYNC\_NOT\_INVOKED}} = 0,}
\DoxyCodeLine{76     \mbox{\hyperlink{s2n__handshake_8h_a2558e05cc7c0ed1ca0078f77b2cd800baac3ac19b87fd8db74416879709d3c6b4}{S2N\_ASYNC\_INVOKING\_CALLBACK}},}
\DoxyCodeLine{77     \mbox{\hyperlink{s2n__handshake_8h_a2558e05cc7c0ed1ca0078f77b2cd800baf8cbfef7fa68b912b82b6ff14d922c84}{S2N\_ASYNC\_INVOKED\_WAITING}},}
\DoxyCodeLine{78     \mbox{\hyperlink{s2n__handshake_8h_a2558e05cc7c0ed1ca0078f77b2cd800ba3a63930d0ac8e174d96fbb3e3eefa274}{S2N\_ASYNC\_INVOKED\_COMPLETE}},}
\DoxyCodeLine{79 \} \mbox{\hyperlink{s2n__handshake_8h_a2558e05cc7c0ed1ca0078f77b2cd800b}{s2n\_async\_state}};}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__handshake__parameters}{s2n\_handshake\_parameters}} \{}
\DoxyCodeLine{82     \textcolor{comment}{/* Signature/hash algorithm pairs offered by the client in the signature\_algorithms extension */}}
\DoxyCodeLine{83     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__sig__scheme__list}{s2n\_sig\_scheme\_list}} \mbox{\hyperlink{structs2n__handshake__parameters_a2127e0decf1934573f6cff34f109cde2}{client\_sig\_hash\_algs}};}
\DoxyCodeLine{84 }
\DoxyCodeLine{85     \textcolor{comment}{/* Signature/hash algorithm pairs offered by the server in the certificate request */}}
\DoxyCodeLine{86     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__sig__scheme__list}{s2n\_sig\_scheme\_list}} \mbox{\hyperlink{structs2n__handshake__parameters_ac0640d80a40559376fca4d833e30dcb6}{server\_sig\_hash\_algs}};}
\DoxyCodeLine{87 }
\DoxyCodeLine{88     \textcolor{comment}{/* The cert chain we will send the peer. */}}
\DoxyCodeLine{89     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__cert__chain__and__key}{s2n\_cert\_chain\_and\_key}} *\mbox{\hyperlink{structs2n__handshake__parameters_adf64dd188fa720c908134458ed50c9e4}{our\_chain\_and\_key}};}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     \textcolor{comment}{/* The subset of certificates that match the server\_name presented in the ClientHello.}}
\DoxyCodeLine{92 \textcolor{comment}{     * In the case of multiple certificates matching a server\_name, s2n will prefer certificates}}
\DoxyCodeLine{93 \textcolor{comment}{     * in FIFO order based on calls to s2n\_config\_add\_cert\_chain\_and\_key\_to\_store}}
\DoxyCodeLine{94 \textcolor{comment}{     *}}
\DoxyCodeLine{95 \textcolor{comment}{     * Note that in addition to domain matching, the key type for the certificate must also be}}
\DoxyCodeLine{96 \textcolor{comment}{     * suitable for a negotiation in order to be selected. The set of matching certs here are indexed}}
\DoxyCodeLine{97 \textcolor{comment}{     * by s2n\_authentication\_method.}}
\DoxyCodeLine{98 \textcolor{comment}{     *}}
\DoxyCodeLine{99 \textcolor{comment}{     * Example:}}
\DoxyCodeLine{100 \textcolor{comment}{     *    -\/ Assume certA is added to s2n\_config via s2n\_config\_add\_cert\_chain\_and\_key\_to\_store}}
\DoxyCodeLine{101 \textcolor{comment}{     *    -\/ Next certB is added.}}
\DoxyCodeLine{102 \textcolor{comment}{     *    -\/ if certA matches www.foo.com and certB matches www.foo.com, s2n will prefer certA}}
\DoxyCodeLine{103 \textcolor{comment}{     *}}
\DoxyCodeLine{104 \textcolor{comment}{     * Note that in addition to domain matching, the key type for the certificate must also be}}
\DoxyCodeLine{105 \textcolor{comment}{     * suitable for a negotiation in order to be selected.}}
\DoxyCodeLine{106 \textcolor{comment}{     *}}
\DoxyCodeLine{107 \textcolor{comment}{     * Example:}}
\DoxyCodeLine{108 \textcolor{comment}{     *    -\/ Assume certA and certB match server\_name www.foo.com}}
\DoxyCodeLine{109 \textcolor{comment}{     *    -\/ certA is ECDSA and certB is RSA.}}
\DoxyCodeLine{110 \textcolor{comment}{     *    -\/ Client only supports RSA ciphers}}
\DoxyCodeLine{111 \textcolor{comment}{     *    -\/ certB will be selected.}}
\DoxyCodeLine{112 \textcolor{comment}{     */}}
\DoxyCodeLine{113     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__cert__chain__and__key}{s2n\_cert\_chain\_and\_key}} *\mbox{\hyperlink{structs2n__handshake__parameters_ab2145ad0b99ef4beb332043ea9b289d6}{exact\_sni\_matches}}[\mbox{\hyperlink{s2n__certificate_8h_a6268a0db3a04623da9e5767e9792c8b8}{S2N\_CERT\_TYPE\_COUNT}}];}
\DoxyCodeLine{114     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__cert__chain__and__key}{s2n\_cert\_chain\_and\_key}} *\mbox{\hyperlink{structs2n__handshake__parameters_a213746e3d0ea0362a851c0bc6c6766ec}{wc\_sni\_matches}}[\mbox{\hyperlink{s2n__certificate_8h_a6268a0db3a04623da9e5767e9792c8b8}{S2N\_CERT\_TYPE\_COUNT}}];}
\DoxyCodeLine{115     uint8\_t \mbox{\hyperlink{structs2n__handshake__parameters_adc6c65fcbe489dc405840b68bbcacc05}{exact\_sni\_match\_exists}};}
\DoxyCodeLine{116     uint8\_t \mbox{\hyperlink{structs2n__handshake__parameters_a9c74ff04d9f86165a18616ac57f7e5f9}{wc\_sni\_match\_exists}};}
\DoxyCodeLine{117 \};}
\DoxyCodeLine{118 }
\DoxyCodeLine{119 \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__handshake}{s2n\_handshake}} \{}
\DoxyCodeLine{120     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__stuffer}{s2n\_stuffer}} \mbox{\hyperlink{structs2n__handshake_ad645624f20fa8968335504114b8ed1c2}{io}};}
\DoxyCodeLine{121 }
\DoxyCodeLine{122     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_ab74077920b2a86a5a2c9cc106cbde382}{md5}};}
\DoxyCodeLine{123     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_a6e44c5e4cdf354f109feeb16fb3901f8}{sha1}};}
\DoxyCodeLine{124     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_a92fe661e399ec5088dbb775a7584f940}{sha224}};}
\DoxyCodeLine{125     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_a667caf4b74b8a416be6bdfe757af2e6d}{sha256}};}
\DoxyCodeLine{126     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_ae18ed7e67d9d214761d8b33300c8faec}{sha384}};}
\DoxyCodeLine{127     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_a8bc54318a8f1e897c9f0cab0c5278f6f}{sha512}};}
\DoxyCodeLine{128     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_ab4cb7d112acb40a9afeed4b793cabd9e}{md5\_sha1}};}
\DoxyCodeLine{129 }
\DoxyCodeLine{130     \textcolor{comment}{/* A copy of the handshake messages hash used to validate the CertificateVerify message */}}
\DoxyCodeLine{131     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_a919673adaf8017cf378dc55095d6cb67}{ccv\_hash\_copy}};}
\DoxyCodeLine{132 }
\DoxyCodeLine{133     \textcolor{comment}{/* Used for SSLv3, TLS 1.0, and TLS 1.1 PRFs */}}
\DoxyCodeLine{134     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_a28959475bac1cd547b11268ef5cb9a1b}{prf\_md5\_hash\_copy}};}
\DoxyCodeLine{135     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_aec3f26b7d0cd6340eec2e383cd893d3b}{prf\_sha1\_hash\_copy}};}
\DoxyCodeLine{136     \textcolor{comment}{/*Used for TLS 1.2 PRF */}}
\DoxyCodeLine{137     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_a82ed801d6ddaea8a5bc1eb3758e30003}{prf\_tls12\_hash\_copy}};}
\DoxyCodeLine{138     \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} \mbox{\hyperlink{structs2n__handshake_a058dbe34b4eb908ee89acd5df295353a}{server\_finished\_copy}};}
\DoxyCodeLine{139 }
\DoxyCodeLine{140     \textcolor{comment}{/* Hash algorithms required for this handshake. The set of required hashes can be reduced as session parameters are}}
\DoxyCodeLine{141 \textcolor{comment}{     * negotiated, i.e. cipher suite and protocol version.}}
\DoxyCodeLine{142 \textcolor{comment}{     */}}
\DoxyCodeLine{143     uint8\_t \mbox{\hyperlink{structs2n__handshake_aa04dec7b675208458f1b80b22ff05513}{required\_hash\_algs}}[\mbox{\hyperlink{s2n__hash_8h_a45fca4e9152a9bfb4b15f8d9f1a074e5a53e508de713c3175e3a46fd5af0bfc2a}{S2N\_HASH\_SENTINEL}}];}
\DoxyCodeLine{144 }
\DoxyCodeLine{145     uint8\_t \mbox{\hyperlink{structs2n__handshake_a7b84ca36575cbadc1ad9f8e1f4a3cdb8}{server\_finished}}[\mbox{\hyperlink{s2n__crypto__constants_8h_a3e2918bb353cd7e9f8bb6aab17214d98}{S2N\_TLS\_SECRET\_LEN}}];}
\DoxyCodeLine{146     uint8\_t \mbox{\hyperlink{structs2n__handshake_a1b7e865e0bf4da43e60511b25eba313c}{client\_finished}}[\mbox{\hyperlink{s2n__crypto__constants_8h_a3e2918bb353cd7e9f8bb6aab17214d98}{S2N\_TLS\_SECRET\_LEN}}];}
\DoxyCodeLine{147 }
\DoxyCodeLine{148     \textcolor{comment}{/* Handshake type is a bitset, with the following}}
\DoxyCodeLine{149 \textcolor{comment}{       bit positions */}}
\DoxyCodeLine{150     uint32\_t \mbox{\hyperlink{structs2n__handshake_a66d5609b305eb97bf409d3cb9ef9fac5}{handshake\_type}};}
\DoxyCodeLine{151 }
\DoxyCodeLine{152 \textcolor{comment}{/* Has the handshake been negotiated yet? */}}
\DoxyCodeLine{153 \textcolor{preprocessor}{\#define INITIAL                     0x00}}
\DoxyCodeLine{154 \textcolor{preprocessor}{\#define NEGOTIATED                  0x01}}
\DoxyCodeLine{155 \textcolor{preprocessor}{\#define IS\_NEGOTIATED( type ) ( (type) \& NEGOTIATED )}}
\DoxyCodeLine{156 }
\DoxyCodeLine{157 \textcolor{comment}{/* Handshake is a full handshake  */}}
\DoxyCodeLine{158 \textcolor{preprocessor}{\#define FULL\_HANDSHAKE              0x02}}
\DoxyCodeLine{159 \textcolor{preprocessor}{\#define IS\_FULL\_HANDSHAKE( type )   ( (type) \& FULL\_HANDSHAKE )}}
\DoxyCodeLine{160 \textcolor{preprocessor}{\#define IS\_RESUMPTION\_HANDSHAKE( type ) ( !IS\_FULL\_HANDSHAKE( (type) ) \&\& IS\_NEGOTIATED ( (type) ) )}}
\DoxyCodeLine{161 }
\DoxyCodeLine{162 \textcolor{comment}{/* Handshake uses perfect forward secrecy */}}
\DoxyCodeLine{163 \textcolor{preprocessor}{\#define TLS12\_PERFECT\_FORWARD\_SECRECY 0x04}}
\DoxyCodeLine{164 }
\DoxyCodeLine{165 \textcolor{comment}{/* Handshake needs OCSP status message */}}
\DoxyCodeLine{166 \textcolor{preprocessor}{\#define OCSP\_STATUS                 0x08}}
\DoxyCodeLine{167 \textcolor{preprocessor}{\#define IS\_OCSP\_STAPLED( type ) ( ( (type) \& OCSP\_STATUS ) != 0 )}}
\DoxyCodeLine{168 }
\DoxyCodeLine{169 \textcolor{comment}{/* Handshake should request a Client Certificate */}}
\DoxyCodeLine{170 \textcolor{preprocessor}{\#define CLIENT\_AUTH                 0x10}}
\DoxyCodeLine{171 \textcolor{preprocessor}{\#define IS\_CLIENT\_AUTH\_HANDSHAKE( type )   ( (type) \& CLIENT\_AUTH )}}
\DoxyCodeLine{172 }
\DoxyCodeLine{173 \textcolor{comment}{/* Session Resumption via session-\/tickets */}}
\DoxyCodeLine{174 \textcolor{preprocessor}{\#define WITH\_SESSION\_TICKET         0x20}}
\DoxyCodeLine{175 \textcolor{preprocessor}{\#define IS\_ISSUING\_NEW\_SESSION\_TICKET( type )   ( (type) \& WITH\_SESSION\_TICKET )}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177 \textcolor{comment}{/* Handshake requested a Client Certificate but did not get one */}}
\DoxyCodeLine{178 \textcolor{preprocessor}{\#define NO\_CLIENT\_CERT              0x40}}
\DoxyCodeLine{179 \textcolor{preprocessor}{\#define IS\_CLIENT\_AUTH\_NO\_CERT( type )   ( IS\_CLIENT\_AUTH\_HANDSHAKE( (type) ) \&\& ( (type) \& NO\_CLIENT\_CERT) )}}
\DoxyCodeLine{180 }
\DoxyCodeLine{181 \textcolor{comment}{/* A HelloRetryRequest was needed to proceed with the handshake */}}
\DoxyCodeLine{182 \textcolor{preprocessor}{\#define HELLO\_RETRY\_REQUEST         0x80}}
\DoxyCodeLine{183 }
\DoxyCodeLine{184 \textcolor{comment}{/* Disguise a TLS1.3 handshake as a TLS1.2 handshake for backwards compatibility}}
\DoxyCodeLine{185 \textcolor{comment}{ * with some middleboxes: https://tools.ietf.org/html/rfc8446\#appendix-\/D.4 */}}
\DoxyCodeLine{186 \textcolor{preprocessor}{\#define MIDDLEBOX\_COMPAT            0x100}}
\DoxyCodeLine{187 \textcolor{preprocessor}{\#define IS\_MIDDLEBOX\_COMPAT\_MODE( type ) ( (type) \& MIDDLEBOX\_COMPAT )}}
\DoxyCodeLine{188 }
\DoxyCodeLine{189     \textcolor{comment}{/* Which handshake message number are we processing */}}
\DoxyCodeLine{190     \textcolor{keywordtype}{int} \mbox{\hyperlink{structs2n__handshake_a5a584a7e9bc20e57f4e5c17e16fe5b11}{message\_number}};}
\DoxyCodeLine{191 }
\DoxyCodeLine{192     \textcolor{comment}{/* State of the async pkey operation during handshake */}}
\DoxyCodeLine{193     \mbox{\hyperlink{s2n__handshake_8h_a2558e05cc7c0ed1ca0078f77b2cd800b}{s2n\_async\_state}} \mbox{\hyperlink{structs2n__handshake_aecffb3d574b36ea7ce784f8520f021b3}{async\_state}};}
\DoxyCodeLine{194 }
\DoxyCodeLine{195     \textcolor{comment}{/* Indicates the CLIENT\_HELLO message has been completely received */}}
\DoxyCodeLine{196     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{structs2n__handshake_a882ac1c4a3e84e92fd102f7a8bd59d4c}{client\_hello\_received}}:1;}
\DoxyCodeLine{197 }
\DoxyCodeLine{198     \textcolor{comment}{/* Indicates the handshake blocked while trying to read or write data, and has been paused */}}
\DoxyCodeLine{199     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{structs2n__handshake_a9e63b32945fb92b96741edb17eae835f}{paused}}:1;}
\DoxyCodeLine{200 }
\DoxyCodeLine{201     \textcolor{comment}{/* Set to 1 if the RSA verification failed */}}
\DoxyCodeLine{202     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{structs2n__handshake_ac350c0934975e1de2d856287e303a53d}{rsa\_failed}}:1;}
\DoxyCodeLine{203 \};}
\DoxyCodeLine{204 }
\DoxyCodeLine{205 \textcolor{keyword}{extern} \mbox{\hyperlink{s2n__handshake_8h_a78b97fef55da786a15a849fd9d7e557c}{message\_type\_t}} \mbox{\hyperlink{s2n__handshake_8h_ad1a464c4f0d92cf0ac994ecd7693bd10}{s2n\_conn\_get\_current\_message\_type}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn);}
\DoxyCodeLine{206 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_a4406f29de6d52b587003368d656dab20}{s2n\_conn\_set\_handshake\_type}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn);}
\DoxyCodeLine{207 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_a1324e0f9143c8cb249b7e819fe81e2ef}{s2n\_conn\_set\_handshake\_no\_client\_cert}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn);}
\DoxyCodeLine{208 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_aeebbea7bdc3a80f52812a7bb4b3f38c1}{s2n\_conn\_set\_handshake\_read\_block}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn);}
\DoxyCodeLine{209 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_ae096884ca55de4f4b2b3c5f44797e71d}{s2n\_conn\_clear\_handshake\_read\_block}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn);}
\DoxyCodeLine{210 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_a1478b6c7ab0fe1f6104b50b52f6bd648}{s2n\_handshake\_require\_all\_hashes}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__handshake}{s2n\_handshake}} *handshake);}
\DoxyCodeLine{211 \textcolor{keyword}{extern} uint8\_t \mbox{\hyperlink{s2n__handshake_8h_af3590807edbdc4911963da683d0d971e}{s2n\_handshake\_is\_hash\_required}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__handshake}{s2n\_handshake}} *handshake, \mbox{\hyperlink{s2n__hash_8h_a45fca4e9152a9bfb4b15f8d9f1a074e5}{s2n\_hash\_algorithm}} hash\_alg);}
\DoxyCodeLine{212 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_a3d7d2eeccc0a0161c6b64d0ef03653c9}{s2n\_conn\_update\_required\_handshake\_hashes}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn);}
\DoxyCodeLine{213 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_a39466dd2c9ea4761cce4569432dd627b}{s2n\_handshake\_get\_hash\_state}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn, \mbox{\hyperlink{s2n__hash_8h_a45fca4e9152a9bfb4b15f8d9f1a074e5}{s2n\_hash\_algorithm}} hash\_alg, \textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__hash__state}{s2n\_hash\_state}} *hash\_state);}
\DoxyCodeLine{214 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_ad4dfd52c43bce970af36644c9258a4e9}{s2n\_handshake\_reset\_hash\_state}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn, \mbox{\hyperlink{s2n__hash_8h_a45fca4e9152a9bfb4b15f8d9f1a074e5}{s2n\_hash\_algorithm}} hash\_alg);}
\DoxyCodeLine{215 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_a873914b2fcb622994fa93a112729eb9f}{s2n\_conn\_find\_name\_matching\_certs}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn);}
\DoxyCodeLine{216 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_aee3bf524e296bb19690109c55b3479d8}{s2n\_create\_wildcard\_hostname}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__stuffer}{s2n\_stuffer}} *hostname, \textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__stuffer}{s2n\_stuffer}} *output);}
\DoxyCodeLine{217 \textcolor{keyword}{struct }\mbox{\hyperlink{structs2n__cert__chain__and__key}{s2n\_cert\_chain\_and\_key}} *\mbox{\hyperlink{s2n__handshake_8h_a074086300ce9cb7a04d4002ace3a753a}{s2n\_get\_compatible\_cert\_chain\_and\_key}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn, \textcolor{keyword}{const} \mbox{\hyperlink{s2n__pkey_8h_a9f8ffb59dc71a9fab8e636972279d441}{s2n\_pkey\_type}} cert\_type);}
\DoxyCodeLine{218 \textcolor{keywordtype}{int} \mbox{\hyperlink{s2n__handshake_8h_a9fa7d896377935d5dec894f583a5e279}{s2n\_conn\_update\_handshake\_hashes}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn, \textcolor{keyword}{struct} s2n\_blob *data);}
\DoxyCodeLine{219 S2N\_RESULT \mbox{\hyperlink{s2n__handshake_8h_aeafadc720afd6a5fb38ef18277786f1d}{s2n\_quic\_read\_handshake\_message}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn, uint8\_t *message\_type);}
\DoxyCodeLine{220 S2N\_RESULT \mbox{\hyperlink{s2n__handshake_8h_a9fea6c4848b3ae51c324374ff4999ada}{s2n\_quic\_write\_handshake\_message}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structs2n__connection}{s2n\_connection}} *conn, \textcolor{keyword}{struct} s2n\_blob *in);}

\end{DoxyCode}
