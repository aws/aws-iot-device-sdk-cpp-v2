\hypertarget{h1__encoder_8h_source}{}\doxysection{h1\+\_\+encoder.\+h}
\label{h1__encoder_8h_source}\index{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/http/include/aws/http/private/h1\_encoder.h@{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/http/include/aws/http/private/h1\_encoder.h}}
\mbox{\hyperlink{h1__encoder_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef AWS\_HTTP\_H1\_ENCODER\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define AWS\_HTTP\_H1\_ENCODER\_H}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{http__impl_8h}{aws/http/private/http\_impl.h}}>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{request__response__impl_8h}{aws/http/private/request\_response\_impl.h}}>}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h1__chunk}{aws\_h1\_chunk}} \{}
\DoxyCodeLine{12     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__allocator}{aws\_allocator}} *\mbox{\hyperlink{structaws__h1__chunk_a70af8e42961de40446d6f35a60633b5a}{allocator}};}
\DoxyCodeLine{13     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__input__stream}{aws\_input\_stream}} *\mbox{\hyperlink{structaws__h1__chunk_ad7a825f9bfb7d2c7fd3e377ab98a004f}{data}};}
\DoxyCodeLine{14     uint64\_t \mbox{\hyperlink{structaws__h1__chunk_a5a999c86a5a8cebc8ea03cd7b208b993}{data\_size}};}
\DoxyCodeLine{15     \mbox{\hyperlink{request__response_8h_ae09746faaa8bc42dccd8a1e7776f2dac}{aws\_http1\_stream\_write\_chunk\_complete\_fn}} *\mbox{\hyperlink{structaws__h1__chunk_ab279535828399736125e40c069817c48}{on\_complete}};}
\DoxyCodeLine{16     \textcolor{keywordtype}{void} *\mbox{\hyperlink{structaws__h1__chunk_a5151c704d7867ccb0cb1041adf72d05a}{user\_data}};}
\DoxyCodeLine{17     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__linked__list__node}{aws\_linked\_list\_node}} \mbox{\hyperlink{structaws__h1__chunk_a2642766b8255b2e33aacc6b1b0f3cabb}{node}};}
\DoxyCodeLine{18     \textcolor{comment}{/* Buffer containing pre-\/encoded start line: chunk-\/size [chunk-\/ext] CRLF */}}
\DoxyCodeLine{19     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__byte__buf}{aws\_byte\_buf}} \mbox{\hyperlink{structaws__h1__chunk_a69891799a06baaa1de1255572b9d2b2b}{chunk\_line}};}
\DoxyCodeLine{20 \};}
\DoxyCodeLine{21 }
\DoxyCodeLine{26 \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h1__encoder__message}{aws\_h1\_encoder\_message}} \{}
\DoxyCodeLine{27     \textcolor{comment}{/* Upon creation, the "{}head"{} (everything preceding body) is buffered here. */}}
\DoxyCodeLine{28     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__byte__buf}{aws\_byte\_buf}} \mbox{\hyperlink{structaws__h1__encoder__message_aa8064dbb8dbab297d8dc5739845bf815}{outgoing\_head\_buf}};}
\DoxyCodeLine{29     \textcolor{comment}{/* Single stream used for unchunked body */}}
\DoxyCodeLine{30     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__input__stream}{aws\_input\_stream}} *\mbox{\hyperlink{structaws__h1__encoder__message_a27c0bf939294070625f450317d35d9dc}{body}};}
\DoxyCodeLine{31 }
\DoxyCodeLine{32     \textcolor{comment}{/* Pointer to list of `struct aws\_h1\_chunk`, used for chunked encoding.}}
\DoxyCodeLine{33 \textcolor{comment}{     * List is owned by aws\_h1\_stream.}}
\DoxyCodeLine{34 \textcolor{comment}{     * Encoder completes/frees/pops front chunk when it's done sending.}}
\DoxyCodeLine{35 \textcolor{comment}{     * If list goes empty, encoder waits for more chunks to arrive.}}
\DoxyCodeLine{36 \textcolor{comment}{     * A chunk with data\_size=0 means "{}final chunk"{} */}}
\DoxyCodeLine{37     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__linked__list}{aws\_linked\_list}} *\mbox{\hyperlink{structaws__h1__encoder__message_a5973f95f429289ef8690a7d1ff125616}{pending\_chunk\_list}};}
\DoxyCodeLine{38 }
\DoxyCodeLine{39     \textcolor{comment}{/* If non-\/zero, length of unchunked body to send */}}
\DoxyCodeLine{40     uint64\_t \mbox{\hyperlink{structaws__h1__encoder__message_acd4ba29ca1d3db1ad19332e6dda8e339}{content\_length}};}
\DoxyCodeLine{41     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h1__encoder__message_a648d111fea7bdde71af2e5c15cde7431}{has\_connection\_close\_header}};}
\DoxyCodeLine{42     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h1__encoder__message_a5d8204929460dc825a3cf6993f79543f}{has\_chunked\_encoding\_header}};}
\DoxyCodeLine{43 \};}
\DoxyCodeLine{44 }
\DoxyCodeLine{45 \textcolor{keyword}{enum} \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512}{aws\_h1\_encoder\_state}} \{}
\DoxyCodeLine{46     \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512a45629448cd344bc292bc1a652f217dc5}{AWS\_H1\_ENCODER\_STATE\_INIT}},}
\DoxyCodeLine{47     \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512a6f1ddf2ed1c19e065fcee1ca5b513676}{AWS\_H1\_ENCODER\_STATE\_HEAD}},}
\DoxyCodeLine{48     \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512a3022d1d6ffa23eac311e0a98442d49d6}{AWS\_H1\_ENCODER\_STATE\_UNCHUNKED\_BODY}},}
\DoxyCodeLine{49     \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512a330a8f67895294f36ed02d8d1a882568}{AWS\_H1\_ENCODER\_STATE\_CHUNK\_NEXT}},}
\DoxyCodeLine{50     \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512a14ec6b24cb4c4892b91bf4722d940659}{AWS\_H1\_ENCODER\_STATE\_CHUNK\_LINE}},}
\DoxyCodeLine{51     \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512abd5c320420336a75958a9aced5e54680}{AWS\_H1\_ENCODER\_STATE\_CHUNK\_BODY}},}
\DoxyCodeLine{52     \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512a1e0d51409b336bf5d9c0cf55bddcc4a0}{AWS\_H1\_ENCODER\_STATE\_CHUNK\_END}},}
\DoxyCodeLine{53     \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512a1dd8284ffaddef44f2b03cfb7c898dc7}{AWS\_H1\_ENCODER\_STATE\_CHUNK\_TRAILER}},}
\DoxyCodeLine{54     \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512a1dedd727f88d20fbcd5d5636c9ccf4b8}{AWS\_H1\_ENCODER\_STATE\_DONE}},}
\DoxyCodeLine{55 \};}
\DoxyCodeLine{56 }
\DoxyCodeLine{57 \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h1__encoder}{aws\_h1\_encoder}} \{}
\DoxyCodeLine{58     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__allocator}{aws\_allocator}} *\mbox{\hyperlink{structaws__h1__encoder_af75e3d0721da5fbadb19b6fd0504c0a3}{allocator}};}
\DoxyCodeLine{59 }
\DoxyCodeLine{60     \textcolor{keyword}{enum} \mbox{\hyperlink{h1__encoder_8h_a17d39daaf33eb833a0b361a179437512}{aws\_h1\_encoder\_state}} \mbox{\hyperlink{structaws__h1__encoder_afd85815a64f6135bce61aabdb27b74fc}{state}};}
\DoxyCodeLine{61     \textcolor{comment}{/* Current message being encoded */}}
\DoxyCodeLine{62     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h1__encoder__message}{aws\_h1\_encoder\_message}} *\mbox{\hyperlink{structaws__h1__encoder_a94ed76f900ac99d30a4b9121289efef8}{message}};}
\DoxyCodeLine{63     \textcolor{comment}{/* Used by some states to track progress. Reset to 0 whenever state changes */}}
\DoxyCodeLine{64     uint64\_t \mbox{\hyperlink{structaws__h1__encoder_af3292793f5a1a757253c1125f7450ed0}{progress\_bytes}};}
\DoxyCodeLine{65     \textcolor{comment}{/* Current chunk */}}
\DoxyCodeLine{66     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h1__chunk}{aws\_h1\_chunk}} *\mbox{\hyperlink{structaws__h1__encoder_ac44ddec13d8165e6f52515e4f5201718}{current\_chunk}};}
\DoxyCodeLine{67     \textcolor{comment}{/* Number of chunks sent, just used for logging */}}
\DoxyCodeLine{68     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{structaws__h1__encoder_a53475b634a5e7af41468199ecc430e88}{chunk\_count}};}
\DoxyCodeLine{69     \textcolor{comment}{/* Encoder logs with this stream ptr as the ID, and passes this ptr to the chunk\_complete callback */}}
\DoxyCodeLine{70     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__http__stream}{aws\_http\_stream}} *\mbox{\hyperlink{structaws__h1__encoder_ae95d7056e0b07c24b321c4f846ef8653}{current\_stream}};}
\DoxyCodeLine{71 \};}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h1__chunk}{aws\_h1\_chunk}} *\mbox{\hyperlink{h1__encoder_8h_ad1e59cada806788c3f67ce390a116096}{aws\_h1\_chunk\_new}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__allocator}{aws\_allocator}} *\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}}, \textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http1__chunk__options}{aws\_http1\_chunk\_options}} *options);}
\DoxyCodeLine{74 }
\DoxyCodeLine{75 \textcolor{comment}{/* Just destroy the chunk (don't fire callback) */}}
\DoxyCodeLine{76 \textcolor{keywordtype}{void} \mbox{\hyperlink{h1__encoder_8h_a7bb1a0c4b42a5af0a440eddc752b8186}{aws\_h1\_chunk\_destroy}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__chunk}{aws\_h1\_chunk}} *chunk);}
\DoxyCodeLine{77 }
\DoxyCodeLine{78 \textcolor{comment}{/* Destroy chunk and fire its completion callback */}}
\DoxyCodeLine{79 \textcolor{keywordtype}{void} \mbox{\hyperlink{h1__encoder_8h_ab386f903228f42dff507cef1b5c9799a}{aws\_h1\_chunk\_complete\_and\_destroy}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__chunk}{aws\_h1\_chunk}} *chunk, \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__stream}{aws\_http\_stream}} *http\_stream, \textcolor{keywordtype}{int} \mbox{\hyperlink{channel__handler__test_8c_a7d16b1c68c87cec009d972e79abfba78}{error\_code}});}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 \textcolor{keywordtype}{int} \mbox{\hyperlink{h1__encoder_8h_a65fb7cd04a8ab01b0e7ff81198fc8481}{aws\_chunk\_line\_from\_options}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http1__chunk__options}{aws\_http1\_chunk\_options}} *options, \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__byte__buf}{aws\_byte\_buf}} *\mbox{\hyperlink{structaws__h1__chunk_a69891799a06baaa1de1255572b9d2b2b}{chunk\_line}});}
\DoxyCodeLine{82 }
\DoxyCodeLine{83 \mbox{\hyperlink{macros_8h_ab6f66af8231eba5da061b9ada0d29bad}{AWS\_EXTERN\_C\_BEGIN}}}
\DoxyCodeLine{84 }
\DoxyCodeLine{85 \textcolor{comment}{/* Validate request and cache any info the encoder will need later in the "{}encoder message"{}. */}}
\DoxyCodeLine{86 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}}}
\DoxyCodeLine{87 \textcolor{keywordtype}{int} \mbox{\hyperlink{h1__encoder_8h_a48876c64d7705aad9290637bc1fe8361}{aws\_h1\_encoder\_message\_init\_from\_request}}(}
\DoxyCodeLine{88     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__encoder__message}{aws\_h1\_encoder\_message}} *\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a6095cc5ed7333d602d0c342e436eb2c5}{message}},}
\DoxyCodeLine{89     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__allocator}{aws\_allocator}} *\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}},}
\DoxyCodeLine{90     \textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__message}{aws\_http\_message}} *request,}
\DoxyCodeLine{91     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__linked__list}{aws\_linked\_list}} *pending\_chunk\_list);}
\DoxyCodeLine{92 }
\DoxyCodeLine{93 \textcolor{keywordtype}{int} \mbox{\hyperlink{h1__encoder_8h_aade6ff5aceeb5b196aa771ba22be0937}{aws\_h1\_encoder\_message\_init\_from\_response}}(}
\DoxyCodeLine{94     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__encoder__message}{aws\_h1\_encoder\_message}} *\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a6095cc5ed7333d602d0c342e436eb2c5}{message}},}
\DoxyCodeLine{95     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__allocator}{aws\_allocator}} *\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}},}
\DoxyCodeLine{96     \textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__message}{aws\_http\_message}} *response,}
\DoxyCodeLine{97     \textcolor{keywordtype}{bool} body\_headers\_ignored,}
\DoxyCodeLine{98     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__linked__list}{aws\_linked\_list}} *pending\_chunk\_list);}
\DoxyCodeLine{99 }
\DoxyCodeLine{100 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}}}
\DoxyCodeLine{101 \textcolor{keywordtype}{void} \mbox{\hyperlink{h1__encoder_8h_a94ed57f2f176c8023dc4b4a325b6f14d}{aws\_h1\_encoder\_message\_clean\_up}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__encoder__message}{aws\_h1\_encoder\_message}} *\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a6095cc5ed7333d602d0c342e436eb2c5}{message}});}
\DoxyCodeLine{102 }
\DoxyCodeLine{103 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}}}
\DoxyCodeLine{104 \textcolor{keywordtype}{void} \mbox{\hyperlink{h1__encoder_8h_a3849fd276aaecc9f8b703228a006c214}{aws\_h1\_encoder\_init}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__encoder}{aws\_h1\_encoder}} *encoder, \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__allocator}{aws\_allocator}} *\mbox{\hyperlink{socket__test_8c_a130cc941753892421e3f70bdee1049d1}{allocator}});}
\DoxyCodeLine{105 }
\DoxyCodeLine{106 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}}}
\DoxyCodeLine{107 \textcolor{keywordtype}{void} \mbox{\hyperlink{h1__encoder_8h_acf3da07dc3c9be84328a177c24c28ace}{aws\_h1\_encoder\_clean\_up}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__encoder}{aws\_h1\_encoder}} *encoder);}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}}}
\DoxyCodeLine{110 \textcolor{keywordtype}{int} \mbox{\hyperlink{h1__encoder_8h_a14fbc70de474bcc20b544b514c522ce3}{aws\_h1\_encoder\_start\_message}}(}
\DoxyCodeLine{111     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__encoder}{aws\_h1\_encoder}} *encoder,}
\DoxyCodeLine{112     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__encoder__message}{aws\_h1\_encoder\_message}} *\mbox{\hyperlink{event__stream__rpc__server__connection__test_8c_a6095cc5ed7333d602d0c342e436eb2c5}{message}},}
\DoxyCodeLine{113     \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__stream}{aws\_http\_stream}} *stream);}
\DoxyCodeLine{114 }
\DoxyCodeLine{115 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}}}
\DoxyCodeLine{116 \textcolor{keywordtype}{int} \mbox{\hyperlink{h1__encoder_8h_a8043a17850ee94b199b0578a5428b899}{aws\_h1\_encoder\_process}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__encoder}{aws\_h1\_encoder}} *encoder, \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__byte__buf}{aws\_byte\_buf}} *out\_buf);}
\DoxyCodeLine{117 }
\DoxyCodeLine{118 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}}}
\DoxyCodeLine{119 \textcolor{keywordtype}{bool} \mbox{\hyperlink{h1__encoder_8h_acac462a616e2fadc085881b0854c3c2c}{aws\_h1\_encoder\_is\_message\_in\_progress}}(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__encoder}{aws\_h1\_encoder}} *encoder);}
\DoxyCodeLine{120 }
\DoxyCodeLine{121 \textcolor{comment}{/* Return true if the encoder is stuck waiting for more chunks to be added to the current message */}}
\DoxyCodeLine{122 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}}}
\DoxyCodeLine{123 \textcolor{keywordtype}{bool} \mbox{\hyperlink{h1__encoder_8h_a6f83bdb4831bb456ad370f9fced670d4}{aws\_h1\_encoder\_is\_waiting\_for\_chunks}}(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h1__encoder}{aws\_h1\_encoder}} *encoder);}
\DoxyCodeLine{124 }
\DoxyCodeLine{125 \mbox{\hyperlink{macros_8h_a24efb76a3b128abc9c35d83cac0030c5}{AWS\_EXTERN\_C\_END}}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* AWS\_HTTP\_H1\_ENCODER\_H */}\textcolor{preprocessor}{}}

\end{DoxyCode}
