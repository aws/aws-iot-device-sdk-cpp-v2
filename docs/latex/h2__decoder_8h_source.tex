\hypertarget{h2__decoder_8h_source}{}\doxysection{h2\+\_\+decoder.\+h}
\label{h2__decoder_8h_source}\index{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/http/include/aws/http/private/h2\_decoder.h@{crt/aws-\/crt-\/cpp/crt/aws-\/c-\/http/include/aws/http/private/h2\_decoder.h}}
\mbox{\hyperlink{h2__decoder_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef AWS\_HTTP\_H2\_DECODER\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define AWS\_HTTP\_H2\_DECODER\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{h2__frames_8h}{aws/http/private/h2\_frames.h}}>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{http__impl_8h}{aws/http/private/http\_impl.h}}>}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{comment}{/* Decoder design goals:}}
\DoxyCodeLine{13 \textcolor{comment}{ * -\/ Minimize state tracking and verification required by user.}}
\DoxyCodeLine{14 \textcolor{comment}{ *   For example, we have \_begin()/\_i()/\_end() callbacks when something happens N times.}}
\DoxyCodeLine{15 \textcolor{comment}{ *   The \_begin() and \_end() callbacks tell the user when to transition states.}}
\DoxyCodeLine{16 \textcolor{comment}{ *   Without them the user needs to be like, oh, I was doing X but now I'm doing Y,}}
\DoxyCodeLine{17 \textcolor{comment}{ *   so I guess I need to end X and start Y.}}
\DoxyCodeLine{18 \textcolor{comment}{}}
\DoxyCodeLine{19 \textcolor{comment}{ * -\/ A callback should result in 1 distinct action.}}
\DoxyCodeLine{20 \textcolor{comment}{ *   For example, we have distinct callbacks for `on\_ping()` and `on\_ping\_ack()`.}}
\DoxyCodeLine{21 \textcolor{comment}{ *   We COULD have had just one `on\_ping(bool ack)` callback, but since user must}}
\DoxyCodeLine{22 \textcolor{comment}{ *   take two complete different actions based on the ACK, we opted for two callbacks.}}
\DoxyCodeLine{23 \textcolor{comment}{ */}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{comment}{/* Return a failed aws\_h2err from any callback to stop the decoder and cause a Connection Error */}}
\DoxyCodeLine{26 \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2__decoder__vtable}{aws\_h2\_decoder\_vtable}} \{}
\DoxyCodeLine{27     \textcolor{comment}{/* For HEADERS header-\/block: \_begin() is called, then 0+ \_i() calls, then \_end().}}
\DoxyCodeLine{28 \textcolor{comment}{     * No other decoder callbacks will occur in this time.}}
\DoxyCodeLine{29 \textcolor{comment}{     * If something is malformed, no further \_i() calls occur, and it is reported in \_end() */}}
\DoxyCodeLine{30     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_aa7790aa18726a668def157a5361c8f76}{on\_headers\_begin}})(uint32\_t stream\_id, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{31     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_ade521cdfd622ddd2468d542ae9ed87c6}{on\_headers\_i}})(}
\DoxyCodeLine{32         uint32\_t stream\_id,}
\DoxyCodeLine{33         \textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__header}{aws\_http\_header}} *header,}
\DoxyCodeLine{34         \textcolor{keyword}{enum} \mbox{\hyperlink{http__impl_8h_a12be5e482ebfe4d5f53c5a493099818f}{aws\_http\_header\_name}} name\_enum,}
\DoxyCodeLine{35         \textcolor{keyword}{enum} \mbox{\hyperlink{request__response_8h_ad38060b55775ed67cd4f7fa2c8d4b266}{aws\_http\_header\_block}} block\_type,}
\DoxyCodeLine{36         \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{37     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (}
\DoxyCodeLine{38         *\mbox{\hyperlink{structaws__h2__decoder__vtable_a741a187e1fc8ee05f23a167bf9fbcfc5}{on\_headers\_end}})(uint32\_t stream\_id, \textcolor{keywordtype}{bool} malformed, \textcolor{keyword}{enum} \mbox{\hyperlink{request__response_8h_ad38060b55775ed67cd4f7fa2c8d4b266}{aws\_http\_header\_block}} block\_type, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     \textcolor{comment}{/* For PUSH\_PROMISE header-\/block: \_begin() is called, then 0+ \_i() calls, then \_end().}}
\DoxyCodeLine{41 \textcolor{comment}{     * No other decoder callbacks will occur in this time.}}
\DoxyCodeLine{42 \textcolor{comment}{     * If something is malformed, no further \_i() calls occur, and it is reported in \_end() */}}
\DoxyCodeLine{43     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_a203bcfc606088f5d95e320d003c4f14a}{on\_push\_promise\_begin}})(uint32\_t stream\_id, uint32\_t promised\_stream\_id, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{44     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_ae44330e8ea2456589b09b692468deae2}{on\_push\_promise\_i}})(}
\DoxyCodeLine{45         uint32\_t stream\_id,}
\DoxyCodeLine{46         \textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http__header}{aws\_http\_header}} *header,}
\DoxyCodeLine{47         \textcolor{keyword}{enum} \mbox{\hyperlink{http__impl_8h_a12be5e482ebfe4d5f53c5a493099818f}{aws\_http\_header\_name}} name\_enum,}
\DoxyCodeLine{48         \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{49     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_a007c218f7caa94b5ca93f150f2a8f1b8}{on\_push\_promise\_end}})(uint32\_t stream\_id, \textcolor{keywordtype}{bool} malformed, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{comment}{/* For DATA frame: \_begin() is called, then 0+ \_i() calls, then \_end().}}
\DoxyCodeLine{52 \textcolor{comment}{     * No other decoder callbacks will occur in this time */}}
\DoxyCodeLine{53     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_ab1431903ce90b64db02448f4f9092a6d}{on\_data\_begin}})(uint32\_t stream\_id, uint32\_t payload\_len, \textcolor{keywordtype}{bool} end\_stream, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{54     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_aa685554f7c7d4110b1715aaf5f24e53a}{on\_data\_i}})(uint32\_t stream\_id, \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} data, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{55     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_a862798b96843499139b81f4fb16b8529}{on\_data\_end}})(uint32\_t stream\_id, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{56 }
\DoxyCodeLine{57     \textcolor{comment}{/* Called at end of DATA frame containing the END\_STREAM flag.}}
\DoxyCodeLine{58 \textcolor{comment}{     * OR called at end of header-\/block which began with HEADERS frame containing the END\_STREAM flag */}}
\DoxyCodeLine{59     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_a06e763bb5b93806d87450431c092629a}{on\_end\_stream}})(uint32\_t stream\_id, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     \textcolor{comment}{/* Called once for RST\_STREAM frame */}}
\DoxyCodeLine{62     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_a9cddde1905311979fd5611a1e55130a9}{on\_rst\_stream}})(uint32\_t stream\_id, uint32\_t \mbox{\hyperlink{channel__handler__test_8c_a7d16b1c68c87cec009d972e79abfba78}{error\_code}}, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{63 }
\DoxyCodeLine{64     \textcolor{comment}{/* Called once For PING frame with ACK flag set */}}
\DoxyCodeLine{65     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_a56802d17a62215fc43fc4abd585f1c12}{on\_ping\_ack}})(uint8\_t opaque\_data[\mbox{\hyperlink{connection_8h_a99cebd5298f16fec37625e4a1a01c64a}{AWS\_HTTP2\_PING\_DATA\_SIZE}}], \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{66 }
\DoxyCodeLine{67     \textcolor{comment}{/* Called once for PING frame (no ACK flag set)*/}}
\DoxyCodeLine{68     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_ae0f99bbe641a32d59550ad15cb48fb98}{on\_ping}})(uint8\_t opaque\_data[\mbox{\hyperlink{connection_8h_a99cebd5298f16fec37625e4a1a01c64a}{AWS\_HTTP2\_PING\_DATA\_SIZE}}], \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     \textcolor{comment}{/* Called once for SETTINGS frame with ACK flag */}}
\DoxyCodeLine{71     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_a6f9ed30e39209199ba77590257e0c764}{on\_settings\_ack}})(\textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{72 }
\DoxyCodeLine{73     \textcolor{comment}{/* Called once for SETTINGS frame, without ACK flag */}}
\DoxyCodeLine{74     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (}
\DoxyCodeLine{75         *\mbox{\hyperlink{structaws__h2__decoder__vtable_a03a4550425ac014bff301d3f2d815fce}{on\_settings}})(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structaws__http2__setting}{aws\_http2\_setting}} *settings\_array, \textcolor{keywordtype}{size\_t} num\_settings, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{76 }
\DoxyCodeLine{77     \textcolor{comment}{/* For GOAWAY frame: \_begin() is called, then 0+ \_i() calls, then \_end().}}
\DoxyCodeLine{78 \textcolor{comment}{     * No other decoder callbacks will occur in this time. */}}
\DoxyCodeLine{79     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (}
\DoxyCodeLine{80         *\mbox{\hyperlink{structaws__h2__decoder__vtable_a73b411e2011d1f9301de165289c659ac}{on\_goaway\_begin}})(uint32\_t last\_stream, uint32\_t \mbox{\hyperlink{channel__handler__test_8c_a7d16b1c68c87cec009d972e79abfba78}{error\_code}}, uint32\_t debug\_data\_length, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{81     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_ab2695c65c873d986ad6abb12c4394501}{on\_goaway\_i}})(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} debug\_data, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{82     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_aa755b3416573462c59f7686d4f8a3a6d}{on\_goaway\_end}})(\textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     \textcolor{comment}{/* Called once for WINDOW\_UPDATE frame */}}
\DoxyCodeLine{85     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} (*\mbox{\hyperlink{structaws__h2__decoder__vtable_a27687287ccad42478521628ea3746657}{on\_window\_update}})(uint32\_t stream\_id, uint32\_t window\_size\_increment, \textcolor{keywordtype}{void} *userdata);}
\DoxyCodeLine{86 \};}
\DoxyCodeLine{87 }
\DoxyCodeLine{91 \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2__decoder__params}{aws\_h2\_decoder\_params}} \{}
\DoxyCodeLine{92     \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__allocator}{aws\_allocator}} *\mbox{\hyperlink{structaws__h2__decoder__params_a01116564d777c6236a54b17c01c27e25}{alloc}};}
\DoxyCodeLine{93     \textcolor{keyword}{const} \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2__decoder__vtable}{aws\_h2\_decoder\_vtable}} *\mbox{\hyperlink{structaws__h2__decoder__params_af36789b257e02b9dacadc379f6dba954}{vtable}};}
\DoxyCodeLine{94     \textcolor{keywordtype}{void} *\mbox{\hyperlink{structaws__h2__decoder__params_ac7d4c72c0eb11854543534288c1809ed}{userdata}};}
\DoxyCodeLine{95     \textcolor{keyword}{const} \textcolor{keywordtype}{void} *\mbox{\hyperlink{structaws__h2__decoder__params_a05485bb7ec498d1b537aa2142cfd5240}{logging\_id}};}
\DoxyCodeLine{96     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h2__decoder__params_a450fab93bf400f99ed36c9aebaa9068e}{is\_server}};}
\DoxyCodeLine{97 }
\DoxyCodeLine{98     \textcolor{comment}{/* If true, do not expect the connection preface and immediately accept any frame type.}}
\DoxyCodeLine{99 \textcolor{comment}{     * Only set this when testing the decoder itself */}}
\DoxyCodeLine{100     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structaws__h2__decoder__params_a728f7d8a6534648b9528a94b3f071644}{skip\_connection\_preface}};}
\DoxyCodeLine{101 \};}
\DoxyCodeLine{102 }
\DoxyCodeLine{103 \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2__decoder}{aws\_h2\_decoder}};}
\DoxyCodeLine{104 }
\DoxyCodeLine{105 \mbox{\hyperlink{macros_8h_ab6f66af8231eba5da061b9ada0d29bad}{AWS\_EXTERN\_C\_BEGIN}}}
\DoxyCodeLine{106 }
\DoxyCodeLine{107 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}} \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2__decoder}{aws\_h2\_decoder}} *\mbox{\hyperlink{h2__decoder_8h_a243c9789125646881231b166502a2d74}{aws\_h2\_decoder\_new}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h2__decoder__params}{aws\_h2\_decoder\_params}} *params);}
\DoxyCodeLine{108 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}} \textcolor{keywordtype}{void} \mbox{\hyperlink{h2__decoder_8h_a3558619f92913a4ea9537a7d31e94ca6}{aws\_h2\_decoder\_destroy}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h2__decoder}{aws\_h2\_decoder}} *decoder);}
\DoxyCodeLine{109 }
\DoxyCodeLine{110 \textcolor{comment}{/* If failed aws\_h2err returned, it is a Connection Error */}}
\DoxyCodeLine{111 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}} \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__h2err}{aws\_h2err}} \mbox{\hyperlink{h2__decoder_8h_a8a0e702399dc227e62cb2bd8febf195b}{aws\_h2\_decode}}(struct \mbox{\hyperlink{structaws__h2__decoder}{aws\_h2\_decoder}} *decoder, \textcolor{keyword}{struct }\mbox{\hyperlink{structaws__byte__cursor}{aws\_byte\_cursor}} *data);}
\DoxyCodeLine{112 }
\DoxyCodeLine{113 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}} \textcolor{keywordtype}{void} \mbox{\hyperlink{h2__decoder_8h_a0fa2e18b36fece55a12642f5fd3d0c26}{aws\_h2\_decoder\_set\_setting\_header\_table\_size}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h2__decoder}{aws\_h2\_decoder}} *decoder, uint32\_t data);}
\DoxyCodeLine{114 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}} \textcolor{keywordtype}{void} \mbox{\hyperlink{h2__decoder_8h_a3c1d6d30284e3e711d84ce201ecbf2bf}{aws\_h2\_decoder\_set\_setting\_enable\_push}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h2__decoder}{aws\_h2\_decoder}} *decoder, uint32\_t data);}
\DoxyCodeLine{115 \mbox{\hyperlink{crt_2aws-crt-cpp_2crt_2aws-c-http_2include_2aws_2http_2_exports_8h_a8eba90dca01a9989cacc0060fa84122a}{AWS\_HTTP\_API}} \textcolor{keywordtype}{void} \mbox{\hyperlink{h2__decoder_8h_a62db19a539dc928ece9fafcc9e7f6f33}{aws\_h2\_decoder\_set\_setting\_max\_frame\_size}}(\textcolor{keyword}{struct} \mbox{\hyperlink{structaws__h2__decoder}{aws\_h2\_decoder}} *decoder, uint32\_t data);}
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \mbox{\hyperlink{macros_8h_a24efb76a3b128abc9c35d83cac0030c5}{AWS\_EXTERN\_C\_END}}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* AWS\_HTTP\_H2\_DECODER\_H */}\textcolor{preprocessor}{}}

\end{DoxyCode}
